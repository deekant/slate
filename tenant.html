<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
      <title>Kill Bill</title>
      <style media="screen">
        .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .ch, .highlight .cd, .highlight .cpf {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s, .highlight .sa, .highlight .dl {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf, .highlight .fm {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv, .highlight .vm {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .nl {
  color: #f92672;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
      </style>
      <style media="print">
        * {
          -webkit-transition:none!important;
          transition:none!important;
        }
        .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight, .highlight .w {
  color: #586e75;
}
.highlight .err {
  color: #002b36;
  background-color: #dc322f;
}
.highlight .c, .highlight .ch, .highlight .cd, .highlight .cm, .highlight .cpf, .highlight .c1, .highlight .cs {
  color: #657b83;
}
.highlight .cp {
  color: #b58900;
}
.highlight .nt {
  color: #b58900;
}
.highlight .o, .highlight .ow {
  color: #93a1a1;
}
.highlight .p, .highlight .pi {
  color: #93a1a1;
}
.highlight .gi {
  color: #859900;
}
.highlight .gd {
  color: #dc322f;
}
.highlight .gh {
  color: #268bd2;
  background-color: #002b36;
  font-weight: bold;
}
.highlight .k, .highlight .kn, .highlight .kp, .highlight .kr, .highlight .kv {
  color: #6c71c4;
}
.highlight .kc {
  color: #cb4b16;
}
.highlight .kt {
  color: #cb4b16;
}
.highlight .kd {
  color: #cb4b16;
}
.highlight .s, .highlight .sb, .highlight .sc, .highlight .dl, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .s1 {
  color: #859900;
}
.highlight .sa {
  color: #6c71c4;
}
.highlight .sr {
  color: #2aa198;
}
.highlight .si {
  color: #d33682;
}
.highlight .se {
  color: #d33682;
}
.highlight .nn {
  color: #b58900;
}
.highlight .nc {
  color: #b58900;
}
.highlight .no {
  color: #b58900;
}
.highlight .na {
  color: #268bd2;
}
.highlight .m, .highlight .mb, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mx {
  color: #859900;
}
.highlight .ss {
  color: #859900;
}
      </style>
      <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
      <link href="stylesheets/print.css" rel="stylesheet" media="print" />
        <script src="javascripts/all.js"></script>
        <script>
          $(function() { setupCodeCopy(); });
        </script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3" />
    </head>
    <body class="tenant" data-languages="[&quot;shell&quot;,&quot;java&quot;,&quot;ruby&quot;,&quot;python&quot;]">
      <header class="header sticky" id="header">
        <div class="header-wrapper">
          <div class="header-logo">
          <div class="logo-switch-wrapper">
              <div class="logo">
              <a href="/">
                <img src="images/logo/light-logo.svg" style="height:38px" alt="Kill Bill Docs" id="logo">
              </a>
            </div>
            <div class="switch">
              <input type="checkbox" id="theme-toggle">
              <span class="slider round"></span>
            </div>
          </div>
            <div class="header-search">
              <div class="search-form-wrapper">
                <div id="docsearch" style="height: 43px; display: flex; align-items: center; width: 100%;">
                </div>
              </div>
            </div>
          </div>
          <div class="nav-toggler sidebar-toggler">
            <svg class="hamburger" xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 24 24" fill="none">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M20.75 7C20.75 7.41421 20.4142 7.75 20 7.75L4 7.75C3.58579 7.75 3.25 7.41421 3.25 7C3.25 6.58579 3.58579 6.25 4 6.25L20 6.25C20.4142 6.25 20.75 6.58579 20.75 7Z" fill=""/>
              <path fill-rule="evenodd" clip-rule="evenodd" d="M20.75 12C20.75 12.4142 20.4142 12.75 20 12.75L4 12.75C3.58579 12.75 3.25 12.4142 3.25 12C3.25 11.5858 3.58579 11.25 4 11.25L20 11.25C20.4142 11.25 20.75 11.5858 20.75 12Z" fill=""/>
              <path fill-rule="evenodd" clip-rule="evenodd" d="M20.75 17C20.75 17.4142 20.4142 17.75 20 17.75L4 17.75C3.58579 17.75 3.25 17.4142 3.25 17C3.25 16.5858 3.58579 16.25 4 16.25L20 16.25C20.4142 16.25 20.75 16.5858 20.75 17Z" fill=""/>
            </svg>
          </div>
            <div class="lang-selector">
                  <a href="#" data-language-name="shell">shell</a>
                  <a href="#" data-language-name="java">java</a>
                  <a href="#" data-language-name="ruby">ruby</a>
                  <a href="#" data-language-name="python">python</a>
            </div>
        </div>
      </header>
      <div class="loader-wrapper">
        <div id="loading"></div>
      </div>
      <script>
        $(window).on('load',function(){
          $('.loader-wrapper').hide();
        });
      </script>
      <a href="#" id="nav-button">
        <span>
          NAV
          <img src="images/navbar.png" alt="" />
        </span>
      </a>
      <div class="toc-wrapper">
          <div class="lang-selector">
                <a href="#" data-language-name="shell">shell</a>
                <a href="#" data-language-name="java">java</a>
                <a href="#" data-language-name="ruby">ruby</a>
                <a href="#" data-language-name="python">python</a>
          </div>
        <ul id="toc" class="toc-list-h1">
            <li>
                <a href="#tenant" class="toc-h1 toc-link" data-title="Tenant">Tenant</a>
                <ul class="toc-list-h2">
                    <li>
                      <a href="#tenant-resource" class="toc-h2 toc-link" data-title="Tenant Resource">Tenant Resource</a>
                    </li>
                    <li>
                      <a href="#tenant-2" class="toc-h2 toc-link" data-title="Tenant">Tenant</a>
                    </li>
                    <li>
                      <a href="#push-notifications" class="toc-h2 toc-link" data-title="Push Notifications">Push Notifications</a>
                    </li>
                    <li>
                      <a href="#tenant-key-value-pairs" class="toc-h2 toc-link" data-title="Tenant Key-Value Pairs">Tenant Key-Value Pairs</a>
                    </li>
                    <li>
                      <a href="#system-properties-configuration" class="toc-h2 toc-link" data-title="System Properties Configuration">System Properties Configuration</a>
                    </li>
                    <li>
                      <a href="#plugin-configuration" class="toc-h2 toc-link" data-title="Plugin Configuration">Plugin Configuration</a>
                    </li>
                    <li>
                      <a href="#payment-state-machines" class="toc-h2 toc-link" data-title="Payment State Machines">Payment State Machines</a>
                    </li>
                </ul>
            </li>
        </ul>
          <ul class="toc-footer">
              <li><a href="mailto:support@killbill.io">Report a doc problem </a></li>
          </ul>
      </div>
      <div class="page-wrapper">
        <div class="content">
          <h1 id='tenant'>Tenant</h1><h2 id='tenant-resource'>Tenant Resource</h2>
<p>Kill Bill has been designed from the ground up as a multi-tenant system, that is, one where multiple unrelated deployments can be hosted on the same physical system. Each deployment has its own separate configuration, catalog, and plugins, and of course its data set is kept entirely separate from the others. RBAC control allows different users/admin/apps to access zero, one or multiple tenants. This <a href="https://killbill.io/blog/subscription-service-using-kill-bill/">blog</a> illustrates some interesting use cases. The <code>Tenant</code> resource allows the management of such tenants.</p>

<p>The attributes of the <code>Tenant</code> resource object are the following:</p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Generated by</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>tenantId</strong></td>
<td>string</td>
<td>system</td>
<td>UUID for this tenant</td>
</tr>
<tr>
<td><strong>externalKey</strong></td>
<td>string</td>
<td>system or user</td>
<td>Optional external key provided by the client</td>
</tr>
<tr>
<td><strong>apiKey</strong></td>
<td>string</td>
<td>user</td>
<td>The API key associated with the tenant</td>
</tr>
<tr>
<td><strong>apiSecret</strong></td>
<td>string</td>
<td>user</td>
<td>The API secret associated with the tenant. This value is hashed and cannot be retrieved.</td>
</tr>
<tr>
<td><strong>auditLogs</strong></td>
<td>array</td>
<td>system</td>
<td>Array of audit log records for this tenant</td>
</tr>
</tbody></table>

<p>Note that the tenant itself has very few attributes, as most attributes belong to the individual accounts and related resources.</p>
<h2 id='tenant-2'>Tenant</h2>
<p>These endpoints manage information that is maintained at the tenant level. Unless otherwise stated, the tenant is identified by its API key in the header.</p>
<h3 id='create-a-tenant'>Create a tenant</h3>
<p>This API creates a new tenant.</p>

<p><strong>Note:</strong> If you create a tenant using this API, it will <em>not</em> be recognized immediately by KAUI because KAUI will be unable to retrieve the <code>apiSecret</code>. To fix this, you should &quot;create&quot; the same tenant separately after logging into KAUI. This will <em>not</em> create another tenant, but it will synchronize KAUI with the one already created.</p>

<p><strong>HTTP Request</strong></p>

<p><code>POST http://127.0.0.1:8080/1.0/kb/tenants</code></p>

<blockquote>
<p>Example Request:</p>
</blockquote>

<p><strong>Request Body</strong></p>

<p>A JSON string representing a Tenant resource. The only parameters required are <code>apiKey</code> and <code>apiSecret</code>. The <code>externalKey</code> is optional and will be set to null if not supplied. The <code>tenantId</code> is generated by the system.</p>

<p><strong>Query Parameters</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Required</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>useGlobalDefault</strong></td>
<td>boolean</td>
<td>false</td>
<td>false</td>
<td>If true, configure the tenant with a default catalog</td>
</tr>
</tbody></table>

<p>Setting the <code>useGlobalDefault</code> parameter to <code>true</code> can be used for test purposes. This will configure the tenant with a default catalog, and therefore make it easy to quickly start playing with the apis. Note that in order to then upload a new custom catalog, one would need to <a href="admin.html#admin-invalidate-caches-for-a-tenant">invalidate the caches for this tenant</a>.</p>

<p><strong>Response</strong></p>

<p>If successful, returns a status code of 201 and an empty body. In addition a <code>Location</code> parameter is returned in the header. This parameter gives the URL for the tenant, including the <code>tenantId</code>.</p>
<h3 id='retrieve-a-tenant-by-id'>Retrieve a tenant by id</h3>
<p>Retrieves a tenant resource, given its ID.</p>

<p><strong>HTTP Request</strong></p>

<p><code>GET http://127.0.0.1:8080/1.0/kb/tenants/{tenantId}</code></p>

<blockquote>
<p>Example Request:</p>
</blockquote>

<blockquote>
<p>Example Response:</p>
</blockquote>

<p><strong>Query Parameters</strong></p>

<p>none</p>

<p><strong>Response</strong></p>

<p>If successful, returns a status code of 200 and a tenant resource object.  The <code>apiSecret</code> attribute is returned as <code>null</code>, since it cannot be retrieved.</p>
<h3 id='retrieve-a-tenant-by-its-api-key'>Retrieve a tenant by its API key</h3>
<p>Retrieves a tenant resource, given its <code>apiKey</code>. The <code>apiKey</code> is passed as a query parameter.</p>

<p><strong>HTTP Request</strong></p>

<p><code>GET http://127.0.0.1:8080/1.0/kb/tenants</code></p>

<blockquote>
<p>Example Request:</p>
</blockquote>

<blockquote>
<p>Example Response:</p>
</blockquote>

<p><strong>Query Parameters</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Required</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>apiKey</strong></td>
<td>string</td>
<td>true</td>
<td>none</td>
<td>api key</td>
</tr>
</tbody></table>

<p><strong>Response</strong></p>

<p>If successful, returns a status code of 200 and a tenant resource object.  The <code>apiSecret</code> attribute is returned as <code>null</code>, since it cannot be retrieved.</p>
<h2 id='push-notifications'>Push Notifications</h2>
<p>Push notifications are a convenient way to get notified about events from the system.
One can register a callback, i.e, a valid URL that will be called whenever there is an event dispatched for this tenant.
Note that this can result in a large number of calls; every time there is a state change for one of the <code>Accounts</code>
in this tenant, the callback will be invoked.</p>

<p>In case of error, the system will retry the callback as defined by the system property <code>org.killbill.billing.server.notifications.retries</code>.</p>

<p>See push notification documentation <a href="https://docs.killbill.io/latest/push_notifications.html">here</a> for further information.</p>
<h3 id='register-a-push-notification'>Register a push notification</h3>
<p>Register a callback URL for this tenant for push notifications.The key name is PUSH_NOTIFICATION_CB. The API sets the value of this key, replacing any previous value.</p>

<p><strong>HTTP Request</strong></p>

<p><code>POST http://127.0.0.1:8080/1.0/kb/tenants/registerNotificationCallback</code></p>

<blockquote>
<p>Example Request:</p>
</blockquote>

<p><strong>Query Parameters</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Required</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>cb</strong></td>
<td>string</td>
<td>true</td>
<td>none</td>
<td>callback URL to register</td>
</tr>
</tbody></table>

<p><strong>Response</strong></p>

<p>If successful, returns a status code of 201 and an empty body. In addition, a <code>Location</code> item is returned in the header giving the URL for this callback.</p>
<h3 id='retrieve-a-registered-push-notification'>Retrieve a registered push notification</h3>
<p>Gets the push notification registered for this tenant, if any.</p>

<p><strong>HTTP Request</strong></p>

<p><code>GET http://127.0.0.1:8080/1.0/kb/tenants/registerNotificationCallback</code></p>

<blockquote>
<p>Example Request:</p>
</blockquote>

<blockquote>
<p>Example Response:</p>
</blockquote>

<p><strong>Query Parameters</strong></p>

<p>None.</p>

<p><strong>Response</strong></p>

<p>If successful, returns a status code of 200 and a body containing a key-value object as follows:</p>

<p>{
  &quot;key&quot;: &quot;PUSH_NOTIFICATION_CB&quot;,
  &quot;values&quot;: list containing the callback URL, if any
}</p>
<h3 id='delete-a-registered-push-notification'>Delete a registered push notification</h3>
<p>Deletes the registered callback URL, if any.</p>

<p><strong>HTTP Request</strong></p>

<p><code>DELETE http://127.0.0.1:8080/1.0/kb/tenants/registerNotificationCallback</code></p>

<blockquote>
<p>Example Request:</p>
</blockquote>

<p><strong>Query Parameters</strong></p>

<p>None.</p>

<p><strong>Response</strong></p>

<p>If successful, returns a status code of 204 and an empty body.</p>
<h2 id='tenant-key-value-pairs'>Tenant Key-Value Pairs</h2>
<p>These endpoints provide a mechanism to register and manage <code>{key, value}</code> pairs for a given tenant. This functionality
is used internally by the system to keep track of all the per-tenant configuration, including system properties, plugin configuration, and others discussed below. In addition, you can add <em>user</em> keys to keep track of additional information that may be desired. For example, some global setting that would be accessible for all plugins could be stored here.</p>
<h3 id='add-a-per-tenant-user-key-value'>Add a per tenant user key/value</h3>
<p>This API adds a key-value pair to the tenant database. If the key already exists its value is replaced. The key is given as a path parameter.</p>

<p><strong>HTTP Request</strong></p>

<p><code>POST http://127.0.0.1:8080/1.0/kb/tenants/userKeyValue/{keyName}</code></p>

<blockquote>
<p>Example Request:</p>
</blockquote>

<p><strong>Request Body</strong></p>

<p>The body contains a single string representing the value.</p>

<p><strong>Query Parameters</strong></p>

<p>None.</p>

<p><strong>Response</strong></p>

<p>If successful, returns a status code of 201 and an empty body. In addition, a <code>Location</code> item is returned in the header giving the URL for this key-value pair.</p>
<h3 id='retrieve-a-per-tenant-user-key-value'>Retrieve a per tenant user key value</h3>
<p>Retrieves the value for a specified key, if it exists, from the tenant database. The key name is given as a path parameter.</p>

<p><strong>HTTP Request</strong></p>

<p><code>GET http://127.0.0.1:8080/1.0/kb/tenants/userKeyValue/{keyName}</code></p>

<blockquote>
<p>Example Request:</p>
</blockquote>

<blockquote>
<p>Example Response:</p>
</blockquote>

<p><strong>Query Parameters</strong></p>

<p>None.</p>

<p><strong>Response</strong></p>

<p>If successful, returns a status code of 200 and a tenant key value object. The key value object includes the key name and a JSON array containing the value, if any, or a comma-separated list of values. For example:</p>

<p>{
  &quot;key&quot;: &quot;MYKEY&quot;,
  &quot;values&quot;: [
    &quot;value1&quot;,
    &quot;value2&quot;
  ]
}</p>

<p>If the key does not exist no error is signalled but the <code>values</code> list is empty.</p>
<h3 id='delete-a-per-tenant-user-key-value'>Delete a per tenant user key/value</h3>
<p>Deletes a key and its value, if it exists, from the tenant database. The key is given as a path parameter.</p>

<p><strong>HTTP Request</strong></p>

<p><code>DELETE http://127.0.0.1:8080/1.0/kb/tenants/userKeyValue/{keyName}</code></p>

<blockquote>
<p>Example Request:</p>
</blockquote>

<p><strong>Query Parameters</strong></p>

<p>None.</p>

<p><strong>Returns</strong></p>

<p>If successful, returns a status code of 204 and an empty body. No error is signalled if the key does not exist.</p>
<h3 id='retrieve-per-tenant-keys-and-values-based-on-a-key-prefix'>Retrieve per tenant keys and values based on a key prefix</h3>
<p>This API enables searching for existing keys based on a prefix of the key name. For example, a search string of &quot;MYK&quot; would match keys such as <code>MYKEY1</code>, <code>MYKEY2</code>, etc. The search string is given as a path parameter.</p>

<p><strong>HTTP Request</strong></p>

<p><code>GET http://127.0.0.1:8080/1.0/kb/tenants/uploadPerTenantConfig/{keyPrefix}/search</code></p>

<blockquote>
<p>Example Request:</p>
</blockquote>

<blockquote>
<p>Example Response:</p>
</blockquote>

<p><strong>Query Parameters</strong></p>

<p>None.</p>

<p><strong>Response</strong></p>

<p>If successful, returns a status code of 200 and a tenant key value object containing the key and values for any keys that match the search string.</p>
<h2 id='system-properties-configuration'>System Properties Configuration</h2>
<p>These endpoints allow setting of some system properties on a per-tenant basis. Please refer to our <a href="https://docs.killbill.io/latest/userguide_configuration.html">configuartion guide</a> to see what can be configured in the system.
Some of the configuration can be overriden at the tenant level to allow for different behaviors.</p>

<p>Note that this is actually a special case of per-tenant key-value pairs; the key is &quot;PER_TENANT_CONFIG&quot; and the value is a comma-separated list of system properties with their values.</p>
<h3 id='add-a-per-tenant-system-properties-configuration'>Add a per tenant system properties configuration</h3>
<p>This API is used to set the value of specific system properties, overriding the system-wide values.</p>

<p>For example, in order to disable the invoice safety bound mechanism on a per-tenant level, this API could be used to set the per-tenant system property <code>org.killbill.invoice.sanitySafetyBoundEnabled</code> to false.</p>

<p>The API sets the value of the &quot;PER_TENANT_CONFIG&quot; key, replacing any previous value.</p>

<p><strong>HTTP Request</strong></p>

<p><code>POST http://127.0.0.1:8080/1.0/kb/tenants/uploadPerTenantConfig</code></p>

<blockquote>
<p>Example Request:</p>
</blockquote>

<p><strong>Request Body</strong></p>

<p>A JSON string representing the per-tenant system property and its value.</p>

<p><strong>Query Parameters</strong></p>

<p>None.</p>

<p><strong>Response</strong></p>

<p>If successful, returns a status code of 201 and an empty body.</p>
<h3 id='retrieve-a-per-tenant-system-properties-configuration'>Retrieve a per tenant system properties configuration</h3>
<p>Retrieves the per-tenant system property settings, which are given as the value of the key <code>PER_TENANT_CONFIG</code>.</p>

<p><strong>HTTP Request</strong></p>

<p><code>GET http://127.0.0.1:8080/1.0/kb/tenants/uploadPerTenantConfig</code></p>

<blockquote>
<p>Example Request:</p>
</blockquote>

<blockquote>
<p>Example Response:</p>
</blockquote>

<p><strong>Query Parameters</strong></p>

<p>None.</p>

<p><strong>Response</strong></p>

<p>If successful, returns a status code of 200 and a tenant key value object for the key <code>PER_TENANT_CONFIG</code>.</p>
<h3 id='delete-a-per-tenant-system-properties-configuration'>Delete a per tenant system properties configuration</h3>
<p>Deletes any current per tenant system properties configuration parameters, which are given as the values of the <code>PER_TENANT_CONFIG</code> key.</p>

<p><strong>HTTP Request</strong></p>

<p><code>DELETE http://127.0.0.1:8080/1.0/kb/tenants/uploadPerTenantConfig</code></p>

<blockquote>
<p>Example Request:</p>
</blockquote>

<p><strong>Query Parameters</strong></p>

<p>None.</p>

<p><strong>Response</strong></p>

<p>If successful, returns a status code of 204 and an empty body.</p>
<h2 id='plugin-configuration'>Plugin Configuration</h2>
<p>Plugins also support configuration on a per-tenant level. Please refer to our <a href="https://docs.killbill.io/latest/plugin_development.html#_plugin_configuration">plugin configuration manual</a> for more details.</p>

<p>An example of the use of such per-tenant properties is to configure a payment plugin with different API keys,
one set of keys for each tenant. This allows for a true multi-tenant deployment where plugins have different configuration
based on the tenant in which they operate.</p>

<p>Upon adding or deleting a new per-tenant plugin configuration, the system will generate a <code>TENANT_CONFIG_CHANGE</code>/<code>TENANT_CONFIG_DELETION</code> event, which can be handled in the plugin to refresh its configuration. In multi-node scenarios, events will be dispatched on each node, that is, on each plugin instance so they end up with a consistent view. A lot of the logic to handle configuration update has been implemented in our plugin frameworks (see <a href="https://github.com/killbill/killbill-plugin-framework-ruby">ruby framework</a> and <a href="https://github.com/killbill/killbill-plugin-framework-java">java framework</a>).</p>

<p>As with the system properties configuration, this is actually a special case of per-tenant key-value pairs. The following endpoints provide the ability to configure plugins on a per-tenant level.</p>
<h3 id='add-a-per-tenant-configuration-for-a-plugin'>Add a per tenant configuration for a plugin</h3>
<p>Adds a per tenant key-value pair for the specified plugin. The plugin name is given as a path parameter. The key name is <code>PLUGIN_CONFIG_*plugin*</code> where <em>plugin</em> is the plugin name. The API sets the value of this key, replacing any previous value.</p>

<p>The value string uploaded is plugin dependent but typically consists of key/value properties,
or well formatted yml or a properties file.</p>

<p><strong>HTTP Request</strong></p>

<p><code>POST http://127.0.0.1:8080/1.0/kb/tenants/uploadPluginConfig/{pluginName}</code></p>

<blockquote>
<p>Example Request:</p>
</blockquote>

<p><strong>Request Body</strong></p>

<p>The request body can be specified as a JSON string consisting of the key-value pairs for the plugin configuration. Alternatively, the plugin configuration can be specified in a yml or properties file and its path can be specified.</p>

<p><strong>Query Parameters</strong></p>

<p>None.</p>

<p><strong>Response</strong></p>

<p>If successful, returns a status code of 201 and an empty body. A <code>Location</code> header is also returned giving the URL of the key-value pair.</p>
<h3 id='retrieve-a-per-tenant-configuration-for-a-plugin'>Retrieve a per tenant configuration for a plugin</h3>
<p>Gets the per tenant configuration value string for a specified plugin. The plugin name is given as a path parameter.</p>

<p><strong>HTTP Request</strong></p>

<p><code>GET http://127.0.0.1:8080/1.0/kb/tenants/uploadPluginConfig/{pluginName}</code></p>

<blockquote>
<p>Example Request:</p>
</blockquote>

<blockquote>
<p>Example Response:</p>
</blockquote>

<p><strong>Query Parameters</strong></p>

<p>None.</p>

<p><strong>Response</strong></p>

<p>If successful, returns a status code of 200 and a tenant key value object for the key <code>PLUGIN_CONFIG_*plugin*</code>.</p>
<h3 id='delete-a-per-tenant-configuration-for-a-plugin'>Delete a per tenant configuration for a plugin</h3>
<p>Deletes the per tenant plugin configuration value for the appropriate key. The plugin name is given as a path parameter.</p>

<p><strong>HTTP Request</strong></p>

<p><code>DELETE http://127.0.0.1:8080/1.0/kb/tenants/uploadPluginConfig/{pluginName}</code></p>

<blockquote>
<p>Example Request:</p>
</blockquote>

<p><strong>Query Parameters</strong></p>

<p>None.</p>

<p><strong>Returns</strong></p>

<p>If successful, returns a status code of 204 and an empty body.</p>
<h2 id='payment-state-machines'>Payment State Machines</h2>
<p>This is a somewhat advanced use case to override the default internal payment state machine within Kill Bill. Please refer to our <a href="https://docs.killbill.io/latest/userguide_payment.html#_payment_states">payment manual</a> for more details about payment states.</p>

<p>The endpoints below allow you to override such state machines on a per-tenant level.</p>
<h3 id='add-a-per-tenant-payment-state-machine-for-a-plugin'>Add a per tenant payment state machine for a plugin</h3>
<p>Adds a per tenant key-value pair for the specified plugin. The plugin name is given as a path parameter. The key name is <code>PLUGIN_PAYMENT_STATE_MACHINE_*plugin*</code> where <em>plugin</em> is the plugin name. The API sets the value of this key, replacing any previous value.</p>

<p>The state machine is defined in an XML file. The complete XML file becomes the value of the key.</p>

<p><strong>HTTP Request</strong></p>

<p>Let&#39;s say we want to overwrite the default Kill Bill payment state machine for the payment plugin <code>demo_plugin</code>, and assuming <code>SimplePaymentStates.xml</code>is a valid payment state machine XML file, then the HTTP Request would be:</p>

<p><code>POST http://127.0.0.1:8080/1.0/kb/tenants/uploadPluginPaymentStateMachineConfig/{pluginName}</code></p>

<blockquote>
<p>Example Request:</p>
</blockquote>

<p><strong>Query Parameters</strong></p>

<p>None.</p>

<p><strong>Response</strong></p>

<p>If successful, returns a status code of 201 and an empty body. In addition, a <code>Location</code> item is returned in the header giving the URL for the payment state machine.</p>
<h3 id='retrieve-a-per-tenant-payment-state-machine-for-a-plugin'>Retrieve a per tenant payment state machine for a plugin</h3>
<p>Retrieves the value for the appropriate payment state machine key for the specified plugin. If present, this value should be the complete XML file that defines the state machine.</p>

<p><strong>HTTP Request</strong></p>

<p><code>GET http://127.0.0.1:8080/1.0/kb/tenants/uploadPluginPaymentStateMachineConfig/{pluginName}</code></p>

<blockquote>
<p>Example Request:</p>
</blockquote>

<blockquote>
<p>Example Response:</p>
</blockquote>

<p><strong>Query Parameters</strong></p>

<p>None.</p>

<p><strong>Response</strong></p>

<p>If successful, returns a status code of 200 and a key value object for the key <code>PLUGIN_PAYMENT_STATE_MACHINE_*plugin*</code>. The value of this key should be the complete XML file that defines the payment state machine.</p>
<h3 id='delete-a-per-tenant-payment-state-machine-for-a-plugin'>Delete a per tenant payment state machine for a plugin</h3>
<p>Deletes the payment state machine for the specified plugin for this tenant. The plugin reverts to the default payment state machine.</p>

<p><strong>HTTP Request</strong></p>

<p><code>DELETE http://127.0.0.1:8080/1.0/kb/tenants/uploadPluginPaymentStateMachineConfig/{pluginName}</code></p>

<blockquote>
<p>Example Request:</p>
</blockquote>

<p><strong>Query Parameters</strong></p>

<p>None.</p>

<p><strong>Returns</strong></p>

<p>If successful, returns a status code of 204 and an empty body.</p>

        </div>
        <div class="dark-box">
          <div id="docsearch"></div>
        </div>
      </div>
    </body>
    <script>
      setTimeout(function(){
        $('.content h2, .content h3, .content h4').append('<a href=""><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>');
        $('.content h2, .content h3, .content h4').each(function(){
          let itemHref = '#' + $(this).attr('id');
          $(this).find('a').attr("href", itemHref);
        });
      })

      setTimeout(() => {
        let childs = []
        let temp = (val) => `<div>${val}</div>`;
        let group = document.createElement('div');
        let groups = []

        for(elem of $('.content').children()) {
          if(elem.tagName === 'H2') {
            groups.push(childs);
            childs = []
          }
          childs.push(elem);
        };

        groups.map(elem => {
          let newElem = document.createElement('div');
          newElem.id = elem[0].id;
          elem.map(el => {
            newElem.appendChild(el)
          });

          $('.content').append(newElem)
        })

        console.log(groups)
      }, 1000)
    </script>
    <script src='https://cdn.jsdelivr.net/npm/@docsearch/js@3'></script>
    <script>
      docsearch({apiKey: '3ef227e7fd5e2e1a3fffd880484934bf', container: '#docsearch', appId: 'S2ISXITURI', indexName: 'killbill_slate'});
    </script>
  </html>
