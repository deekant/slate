<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
      <title>Kill Bill</title>
      <style media="screen">
        .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .ch, .highlight .cd, .highlight .cpf {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s, .highlight .sa, .highlight .dl {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf, .highlight .fm {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv, .highlight .vm {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .nl {
  color: #f92672;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
      </style>
      <style media="print">
        * {
          -webkit-transition:none!important;
          transition:none!important;
        }
        .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight, .highlight .w {
  color: #586e75;
}
.highlight .err {
  color: #002b36;
  background-color: #dc322f;
}
.highlight .c, .highlight .ch, .highlight .cd, .highlight .cm, .highlight .cpf, .highlight .c1, .highlight .cs {
  color: #657b83;
}
.highlight .cp {
  color: #b58900;
}
.highlight .nt {
  color: #b58900;
}
.highlight .o, .highlight .ow {
  color: #93a1a1;
}
.highlight .p, .highlight .pi {
  color: #93a1a1;
}
.highlight .gi {
  color: #859900;
}
.highlight .gd {
  color: #dc322f;
}
.highlight .gh {
  color: #268bd2;
  background-color: #002b36;
  font-weight: bold;
}
.highlight .k, .highlight .kn, .highlight .kp, .highlight .kr, .highlight .kv {
  color: #6c71c4;
}
.highlight .kc {
  color: #cb4b16;
}
.highlight .kt {
  color: #cb4b16;
}
.highlight .kd {
  color: #cb4b16;
}
.highlight .s, .highlight .sb, .highlight .sc, .highlight .dl, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .s1 {
  color: #859900;
}
.highlight .sa {
  color: #6c71c4;
}
.highlight .sr {
  color: #2aa198;
}
.highlight .si {
  color: #d33682;
}
.highlight .se {
  color: #d33682;
}
.highlight .nn {
  color: #b58900;
}
.highlight .nc {
  color: #b58900;
}
.highlight .no {
  color: #b58900;
}
.highlight .na {
  color: #268bd2;
}
.highlight .m, .highlight .mb, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mx {
  color: #859900;
}
.highlight .ss {
  color: #859900;
}
      </style>
      <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
      <link href="stylesheets/print.css" rel="stylesheet" media="print" />
        <script src="javascripts/all.js"></script>
        <script>
          $(function() { setupCodeCopy(); });
        </script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3" />
    </head>
    <body class="payment" data-languages="[&quot;shell&quot;,&quot;java&quot;,&quot;ruby&quot;,&quot;python&quot;]">
      <header class="header sticky" id="header">
        <div class="header-wrapper">
          <div class="header-logo">
            <div class="logo-switch-wrapper">
              <div class="logo">
                <a href="/">
                  <img src="images/logo/light-logo.svg" style="height:38px" alt="Kill Bill Docs" id="logo">
                </a>
              </div>
              <div class="switch">
                <input type="checkbox" id="theme-toggle">
                <span class="slider round"></span>
              </div>
            </div>
            <div class="header-search">
              <div class="search-form-wrapper">
                <div id="docsearch" style="height: 43px; display: flex; align-items: center; width: 100%;">
                </div>
              </div>
            </div>
          </div>
          <div class="nav-toggler sidebar-toggler">
            <svg class="hamburger" xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 24 24" fill="none">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M20.75 7C20.75 7.41421 20.4142 7.75 20 7.75L4 7.75C3.58579 7.75 3.25 7.41421 3.25 7C3.25 6.58579 3.58579 6.25 4 6.25L20 6.25C20.4142 6.25 20.75 6.58579 20.75 7Z" fill=""/>
              <path fill-rule="evenodd" clip-rule="evenodd" d="M20.75 12C20.75 12.4142 20.4142 12.75 20 12.75L4 12.75C3.58579 12.75 3.25 12.4142 3.25 12C3.25 11.5858 3.58579 11.25 4 11.25L20 11.25C20.4142 11.25 20.75 11.5858 20.75 12Z" fill=""/>
              <path fill-rule="evenodd" clip-rule="evenodd" d="M20.75 17C20.75 17.4142 20.4142 17.75 20 17.75L4 17.75C3.58579 17.75 3.25 17.4142 3.25 17C3.25 16.5858 3.58579 16.25 4 16.25L20 16.25C20.4142 16.25 20.75 16.5858 20.75 17Z" fill=""/>
            </svg>
          </div>
            <div class="lang-selector">
              <select class="mob-lang-selector">
                  <option data-language-name="shell" value="shell">shell</option>
                  <option data-language-name="java" value="java">java</option>
                  <option data-language-name="ruby" value="ruby">ruby</option>
                  <option data-language-name="python" value="python">python</option>
              </select>
                  <a href="#" data-language-name="shell">shell</a>
                  <a href="#" data-language-name="java">java</a>
                  <a href="#" data-language-name="ruby">ruby</a>
                  <a href="#" data-language-name="python">python</a>
            </div>
        </div>
      </header>
      <div class="loader-wrapper">
        <div id="loading"></div>
      </div>
      <script>
        $(window).on('load',function(){
          $('.loader-wrapper').hide();
        });
      </script>
      <a href="#" id="nav-button">
        <span>
          NAV
          <img src="images/navbar.png" alt="" />
        </span>
      </a>
      <div class="toc-wrapper">
          <div class="lang-selector">
                <a href="#" data-language-name="shell">shell</a>
                <a href="#" data-language-name="java">java</a>
                <a href="#" data-language-name="ruby">ruby</a>
                <a href="#" data-language-name="python">python</a>
          </div>
        <ul id="toc" class="toc-list-h1">
            <li>
                <a href="#payment" class="toc-h1 toc-link" data-title="Payment">Payment</a>
                <ul class="toc-list-h2">
                    <li>
                      <a href="#payment-resource" class="toc-h2 toc-link" data-title="Payment Resource">Payment Resource</a>
                    </li>
                    <li>
                      <a href="#payments" class="toc-h2 toc-link" data-title="Payments">Payments</a>
                    </li>
                    <li>
                      <a href="#custom-fields" class="toc-h2 toc-link" data-title="Custom Fields">Custom Fields</a>
                    </li>
                    <li>
                      <a href="#tags" class="toc-h2 toc-link" data-title="Tags">Tags</a>
                    </li>
                    <li>
                      <a href="#audit-logs" class="toc-h2 toc-link" data-title="Audit Logs">Audit Logs</a>
                    </li>
                    <li>
                      <a href="#list-and-search" class="toc-h2 toc-link" data-title="List and Search">List and Search</a>
                    </li>
                </ul>
            </li>
        </ul>
          <ul class="toc-footer">
              <li><a href="mailto:support@killbill.io">Report a doc problem </a></li>
          </ul>
      </div>
      <div class="page-wrapper">
        <div class="content">
          <h1 id='payment'>Payment</h1>
<p>A Payment in Kill Bill is an amount paid or payable on a specific account due to an invoice or independent of any invoice.</p>

<p>A Payment may be associated with a series of <code>PaymentTransaction</code>s, such as authorization, payment attempt, chargeback, etc. each of which may succeed or fail.</p>

<p>A Payment Transaction takes place using a <code>PaymentMethod</code> such as a credit card. The transaction is processed by a plugin, which provides access to the appropriate payment gateway. The payment gateway processes the transaction, using the Payment Method provided in the request.</p>

<p>A Payment Attempt is an attempt to perform a Payment Transaction. A Payment Attempt may succeed or fail, and a Payment Transaction may have more than one Payment Attempt. In some cases a Payment Transaction may be in a PENDING state waiting for completion of its processing by the plugin.</p>

<p>Please refer to the <a href="http://docs.killbill.io/latest/userguide_payment.html">payment manual</a> for more details.</p>
<h2 id='payment-resource'>Payment Resource</h2>
<p>A Payment is represented by a <code>Payment</code> resource object. The attributes for the Payment resource are as follows:</p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Generated by</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>paymentId</strong></td>
<td>string</td>
<td>system</td>
<td>UUID for the payment</td>
</tr>
<tr>
<td><strong>accountId</strong></td>
<td>string</td>
<td>system</td>
<td>UUID for the account</td>
</tr>
<tr>
<td><strong>paymentNumber</strong></td>
<td>number</td>
<td>user or system</td>
<td>User&#39;s ID number for the payment</td>
</tr>
<tr>
<td><strong>paymentExternalKey</strong></td>
<td>string</td>
<td>user or system</td>
<td>Optional external key</td>
</tr>
<tr>
<td><strong>authAmount</strong></td>
<td>string</td>
<td>system</td>
<td>Total amount authorized (see below)</td>
</tr>
<tr>
<td><strong>capturedAmount</strong></td>
<td>string</td>
<td>system</td>
<td>Total amount captured (see below)</td>
</tr>
<tr>
<td><strong>purchasedAmount</strong></td>
<td>string</td>
<td>system</td>
<td>Total amount purchased (see below)</td>
</tr>
<tr>
<td><strong>refundedAmount</strong></td>
<td>string</td>
<td>system</td>
<td>Total amount refunded (see below)</td>
</tr>
<tr>
<td><strong>creditedAmount</strong></td>
<td>string</td>
<td>system</td>
<td>Total amount credited (see below)</td>
</tr>
<tr>
<td><strong>currency</strong></td>
<td>string</td>
<td>user or system</td>
<td>Currency associated with the account</td>
</tr>
<tr>
<td><strong>paymentMethodId</strong></td>
<td>string</td>
<td>system</td>
<td>UUID for the payment method</td>
</tr>
<tr>
<td><strong>transactions</strong></td>
<td>list</td>
<td>system</td>
<td><strong>PaymentTransactions</strong> associated with this payment (see below)</td>
</tr>
<tr>
<td><strong>paymentAttempts</strong></td>
<td>list</td>
<td>system</td>
<td>Payment retries (see below)</td>
</tr>
</tbody></table>

<ul>
<li><p><strong>authAmount</strong>: Total amount that is authorized for this payment. Often this is the amount authorized by a single AUTHORIZATION Payment Transaction.</p></li>
<li><p><strong>capturedAmount</strong>: Total amount that has been captured (that is, successfully paid).</p></li>
<li><p><strong>purchasedAmount</strong>: Total amount that has been purchased. A PURCHASE transaction combines authorization and capture.</p></li>
<li><p><strong>refundedAmount</strong>: Total amount that has been refunded.</p></li>
<li><p><strong>creditedAmount</strong>: Total amount that has been credited.</p></li>
<li><p><strong>paymentAttempts</strong>: Number of payment attempts; this is only effective when the system has been configured to retry failed transactions.</p></li>
</ul>

<p>The attributes for a <code>PaymentTransaction</code> are described <a href="payment-transaction.html#payment-transaction-payments-transactions">here</a>.</p>
<h2 id='payments'>Payments</h2>
<p>These endpoints initiate transactions on an existing Payment. To begin a new Payment, see <a href="account.html#account-trigger-a-payment-authorization-purchase-or-credit">Trigger a Payment</a> in the Account API. </p>
<h3 id='capture-an-existing-authorization-using-paymentid'>Capture an existing authorization [using paymentId]</h3>
<p>Attempts to capture a payment amount based on a prior authorization. (A prior authorization may be created via the <a href="account.html#account-trigger-a-payment-authorization-purchase-or-credit">Trigger a Payment</a> endpoint). The Payment is identified by its <code>paymentId</code> provided as a path parameter.</p>

<p><strong>HTTP Request</strong> </p>

<p><code>POST http://127.0.0.1:8080/1.0/kb/payments/{paymentId}</code></p>

<blockquote>
<p>Example Request:</p>
</blockquote>
<div class="highlight"><pre class="highlight shell tab-shell"><code>curl <span class="nt">-v</span> <span class="se">\</span>
    <span class="nt">-X</span> POST <span class="se">\</span>
    <span class="nt">-u</span> admin:password <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiKey: bob'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiSecret: lazar'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-CreatedBy: demo'</span> <span class="se">\</span>
    <span class="nt">-d</span> <span class="s1">'{
          "amount": 5
        }'</span> <span class="se">\</span>
    <span class="s1">'http://127.0.0.1:8080/1.0/kb/payments/8fe697d4-2c25-482c-aa45-f6cd5a48186d'</span> 
</code></pre></div><div class="highlight"><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">org.killbill.billing.client.api.gen.PaymentApi</span><span class="o">;</span>
<span class="kd">protected</span> <span class="nc">PaymentApi</span> <span class="n">paymentApi</span><span class="o">;</span>

<span class="no">UUID</span> <span class="n">paymentId</span> <span class="o">=</span> <span class="no">UUID</span><span class="o">.</span><span class="na">fromString</span><span class="o">(</span><span class="s">"33eae7eb-0ad4-45d6-a12a-940e0b460be4"</span><span class="o">);</span>

<span class="nc">PaymentTransaction</span> <span class="n">captureTransaction</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PaymentTransaction</span><span class="o">();</span>
<span class="n">captureTransaction</span><span class="o">.</span><span class="na">setPaymentId</span><span class="o">(</span><span class="n">paymentId</span><span class="o">);</span>
<span class="n">captureTransaction</span><span class="o">.</span><span class="na">setAmount</span><span class="o">(</span><span class="nc">BigDecimal</span><span class="o">.</span><span class="na">ONE</span><span class="o">);</span>
<span class="n">captureTransaction</span><span class="o">.</span><span class="na">setCurrency</span><span class="o">(</span><span class="nc">Currency</span><span class="o">.</span><span class="na">USD</span><span class="o">);</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="no">NULL_PLUGIN_NAMES</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="no">NULL_PLUGIN_PROPERTIES</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

<span class="nc">Payment</span> <span class="n">capturedPayment</span> <span class="o">=</span> <span class="n">paymentApi</span><span class="o">.</span><span class="na">captureAuthorization</span><span class="o">(</span><span class="n">paymentId</span><span class="o">,</span> 
                                                          <span class="n">captureTransaction</span><span class="o">,</span> 
                                                          <span class="no">NULL_PLUGIN_NAMES</span><span class="o">,</span> 
                                                          <span class="no">NULL_PLUGIN_PROPERTIES</span><span class="o">,</span> 
                                                          <span class="n">requestOptions</span><span class="o">);</span>
</code></pre></div><div class="highlight"><pre class="highlight ruby tab-ruby"><code><span class="n">transaction</span>            <span class="o">=</span> <span class="no">KillBillClient</span><span class="o">::</span><span class="no">Model</span><span class="o">::</span><span class="no">Transaction</span><span class="p">.</span><span class="nf">new</span>
<span class="n">transaction</span><span class="p">.</span><span class="nf">payment_id</span> <span class="o">=</span> <span class="s2">"b2a187b8-0028-4de8-b349-0ebe4e714a5a"</span>
<span class="n">transaction</span><span class="p">.</span><span class="nf">amount</span>     <span class="o">=</span> <span class="s2">"483.22"</span>
<span class="n">transaction</span><span class="p">.</span><span class="nf">currency</span>   <span class="o">=</span> <span class="s2">"BTC"</span>

<span class="n">transaction</span><span class="p">.</span><span class="nf">capture</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> 
                    <span class="n">reason</span><span class="p">,</span> 
                    <span class="n">comment</span><span class="p">,</span> 
                    <span class="n">options</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="n">paymentApi</span> <span class="o">=</span> <span class="n">killbill</span><span class="p">.</span><span class="n">api</span><span class="p">.</span><span class="n">PaymentApi</span><span class="p">()</span>
<span class="n">payment_id</span> <span class="o">=</span> <span class="s">'b2a187b8-0028-4de8-b349-0ebe4e714a5a'</span>
<span class="n">body</span> <span class="o">=</span> <span class="n">PaymentTransaction</span><span class="p">(</span><span class="n">payment_id</span><span class="o">=</span><span class="n">payment_id</span><span class="p">,</span> 
                          <span class="n">amount</span><span class="o">=</span><span class="mf">50.0</span><span class="p">,</span> 
                          <span class="n">currency</span><span class="o">=</span><span class="s">'USD'</span><span class="p">)</span>

<span class="n">paymentApi</span><span class="p">.</span><span class="n">capture_authorization</span><span class="p">(</span><span class="n">payment_id</span><span class="p">,</span>
                                 <span class="n">body</span><span class="p">,</span>
                                 <span class="n">created_by</span><span class="p">,</span>
                                 <span class="n">api_key</span><span class="p">,</span>
                                 <span class="n">api_secret</span><span class="p">)</span>
</code></pre></div>
<p><strong>Request Body</strong></p>

<p>A <code>PaymentTransaction</code> object containing, as a minimum, the <code>amount</code> to be captured.</p>

<p><strong>Query Parameters</strong></p>

<p>None.</p>

<p><strong>Response</strong></p>

<p>If successful, returns a status code of 201 and an empty body. A Location header containing the payment id is also included in the response. A PaymentTransaction of type CAPTURE is created.</p>
<h3 id='capture-an-existing-authorization-using-paymentexternalkey'>Capture an existing authorization [using paymentExternalKey]</h3>
<p>Requests a payment amount based on a prior authorization.(A prior authorization may be created via the <a href="account.html#account-trigger-a-payment-authorization-purchase-or-credit">Trigger a Payment</a> endpoint).The payment is identified by its external key given in the request body.</p>

<p><strong>HTTP Request</strong> </p>

<p><code>POST http://127.0.0.1:8080/1.0/kb/payments</code></p>

<blockquote>
<p>Example Request:</p>
</blockquote>
<div class="highlight"><pre class="highlight shell tab-shell"><code>curl <span class="nt">-v</span> <span class="se">\</span>
    <span class="nt">-X</span> POST <span class="se">\</span>
    <span class="nt">-u</span> admin:password <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiKey: bob'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiSecret: lazar'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-CreatedBy: demo'</span> <span class="se">\</span>
    <span class="nt">-d</span> <span class="s1">'{
          "paymentExternalKey": "paymentExternalKey",
          "amount": 1
        }'</span> <span class="se">\</span>
    <span class="s1">'http://127.0.0.1:8080/1.0/kb/payments'</span>     
</code></pre></div><div class="highlight"><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">org.killbill.billing.client.api.gen.PaymentApi</span><span class="o">;</span>
<span class="kd">protected</span> <span class="nc">PaymentApi</span> <span class="n">paymentApi</span><span class="o">;</span>

<span class="nc">PaymentTransaction</span> <span class="n">captureTransaction</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PaymentTransaction</span><span class="o">();</span>
<span class="n">captureTransaction</span><span class="o">.</span><span class="na">setAmount</span><span class="o">(</span><span class="nc">BigDecimal</span><span class="o">.</span><span class="na">ONE</span><span class="o">);</span>
<span class="n">captureTransaction</span><span class="o">.</span><span class="na">setCurrency</span><span class="o">(</span><span class="nc">Currency</span><span class="o">.</span><span class="na">USD</span><span class="o">);</span>
<span class="n">captureTransaction</span><span class="o">.</span><span class="na">setPaymentExternalKey</span><span class="o">(</span><span class="s">"8e0c507a-05f9-4572-a57d-3f742cdc040d"</span><span class="o">);</span> <span class="c1">//payment external key</span>
<span class="n">captureTransaction</span><span class="o">.</span><span class="na">setTransactionExternalKey</span><span class="o">(</span><span class="s">"9b4dbbe7-749d-4c96-a2e7-57b8bff3bf05"</span><span class="o">);</span> <span class="c1">//external key to be set on the newly created CAPTURE transaction</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="no">NULL_PLUGIN_NAMES</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="no">NULL_PLUGIN_PROPERTIES</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

<span class="nc">Payment</span> <span class="n">capturedPayment2</span> <span class="o">=</span> <span class="n">paymentApi</span><span class="o">.</span><span class="na">captureAuthorizationByExternalKey</span><span class="o">(</span><span class="n">captureTransaction</span><span class="o">,</span> 
                                                                        <span class="no">NULL_PLUGIN_NAMES</span><span class="o">,</span> 
                                                                        <span class="no">NULL_PLUGIN_PROPERTIES</span><span class="o">,</span> 
                                                                        <span class="n">requestOptions</span><span class="o">);</span>
</code></pre></div><div class="highlight"><pre class="highlight ruby tab-ruby"><code><span class="n">transaction</span>                          <span class="o">=</span> <span class="no">KillBillClient</span><span class="o">::</span><span class="no">Model</span><span class="o">::</span><span class="no">Transaction</span><span class="p">.</span><span class="nf">new</span>
<span class="n">transaction</span><span class="p">.</span><span class="nf">amount</span>                   <span class="o">=</span> <span class="s2">"483.22"</span>
<span class="n">transaction</span><span class="p">.</span><span class="nf">currency</span>                 <span class="o">=</span> <span class="s2">"BTC"</span>
<span class="n">transaction</span><span class="p">.</span><span class="nf">transaction_external_key</span> <span class="o">=</span> <span class="s2">"payment1-323475"</span>

<span class="n">transaction</span><span class="p">.</span><span class="nf">capture</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> 
                    <span class="n">reason</span><span class="p">,</span> 
                    <span class="n">comment</span><span class="p">,</span> 
                    <span class="n">options</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="n">paymentApi</span> <span class="o">=</span> <span class="n">killbill</span><span class="p">.</span><span class="n">api</span><span class="p">.</span><span class="n">PaymentApi</span><span class="p">()</span>
<span class="n">payment_external_key</span> <span class="o">=</span> <span class="s">'sample_external_key'</span>
<span class="n">body</span> <span class="o">=</span> <span class="n">PaymentTransaction</span><span class="p">(</span><span class="n">payment_external_key</span><span class="o">=</span><span class="n">payment_external_key</span><span class="p">,</span>
                          <span class="n">amount</span><span class="o">=</span><span class="mf">50.0</span><span class="p">,</span>
                          <span class="n">currency</span><span class="o">=</span><span class="s">'USD'</span><span class="p">)</span>

<span class="n">paymentApi</span><span class="p">.</span><span class="n">capture_authorization_by_external_key</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> 
                                                 <span class="n">created_by</span><span class="p">,</span> 
                                                 <span class="n">api_key</span><span class="p">,</span> 
                                                 <span class="n">api_secret</span><span class="p">)</span>
</code></pre></div>
<p><strong>Request Body</strong></p>

<p>A <code>PaymentTransaction</code> object containing, as a minimum, the <code>paymentExternalKey</code> and the<code>amount</code> to be captured.</p>

<p><strong>Query Parameters</strong></p>

<p>None.</p>

<p><strong>Response</strong></p>

<p>If successful, returns a status code of 201 and an empty body. A Location header containing the payment id is also included in the response. A PaymentTransaction of type CAPTURE is created.</p>
<h3 id='retrieve-a-payment-using-paymentid'>Retrieve a payment [using paymentId]</h3>
<p>Retrieves a <code>Payment</code> object based on its <code>paymentId</code> given as a path parameter.</p>

<p><strong>HTTP Request</strong> </p>

<p><code>GET http://127.0.0.1:8080/1.0/kb/payments/{paymentId}</code></p>

<blockquote>
<p>Example Request:</p>
</blockquote>
<div class="highlight"><pre class="highlight shell tab-shell"><code>curl <span class="se">\</span>
    <span class="nt">-u</span> admin:password <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiKey: bob'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiSecret: lazar'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'Accept: application/json'</span> <span class="se">\</span>
    <span class="s1">'http://127.0.0.1:8080/1.0/kb/payments/8fe697d4-2c25-482c-aa45-f6cd5a48186d'</span> 
</code></pre></div><div class="highlight"><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">org.killbill.billing.client.api.gen.PaymentApi</span><span class="o">;</span>
<span class="kd">protected</span> <span class="nc">PaymentApi</span> <span class="n">paymentApi</span><span class="o">;</span>

<span class="no">UUID</span> <span class="n">paymentId</span> <span class="o">=</span> <span class="no">UUID</span><span class="o">.</span><span class="na">fromString</span><span class="o">(</span><span class="s">"cca08349-8b26-41c7-bfcc-2e3cf70a0f28"</span><span class="o">);</span>
<span class="nc">Boolean</span> <span class="n">withPluginInfo</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span> <span class="c1">// Will not reflect plugin info</span>
<span class="nc">Boolean</span> <span class="n">withAttempts</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span> <span class="c1">// Will reflect payment attempts</span>
<span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="no">NULL_PLUGIN_PROPERTIES</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

<span class="nc">Payment</span> <span class="n">payment</span> <span class="o">=</span> <span class="n">paymentApi</span><span class="o">.</span><span class="na">getPayment</span><span class="o">(</span><span class="n">paymentId</span><span class="o">,</span> 
                                        <span class="n">withPluginInfo</span><span class="o">,</span> 
                                        <span class="n">withAttempts</span><span class="o">,</span> 
                                        <span class="no">NULL_PLUGIN_PROPERTIES</span><span class="o">,</span> 
                                        <span class="nc">AuditLevel</span><span class="o">.</span><span class="na">NONE</span><span class="o">,</span> 
                                        <span class="n">requestOptions</span><span class="o">);</span>
</code></pre></div><div class="highlight"><pre class="highlight ruby tab-ruby"><code><span class="n">payment_id</span> <span class="o">=</span> <span class="s2">"12c70604-cede-4df3-a321-38be4d176e9a"</span>
<span class="n">with_plugin_info</span> <span class="o">=</span> <span class="kp">false</span>
<span class="n">with_attempts</span> <span class="o">=</span> <span class="kp">false</span>

<span class="no">KillBillClient</span><span class="o">::</span><span class="no">Model</span><span class="o">::</span><span class="no">Payment</span><span class="p">.</span><span class="nf">find_by_id</span><span class="p">(</span><span class="n">payment_id</span><span class="p">,</span> 
                                          <span class="n">with_plugin_info</span><span class="p">,</span> 
                                          <span class="n">with_attempts</span><span class="p">,</span> 
                                          <span class="n">options</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="n">paymentApi</span> <span class="o">=</span> <span class="n">killbill</span><span class="p">.</span><span class="n">api</span><span class="p">.</span><span class="n">PaymentApi</span><span class="p">()</span>
<span class="n">payment_id</span> <span class="o">=</span> <span class="s">'ce88ae5b-7ec0-4e14-9ea1-fffe4411278e'</span>

<span class="n">paymentApi</span><span class="p">.</span><span class="n">get_payment</span><span class="p">(</span><span class="n">payment_id</span><span class="p">,</span> <span class="n">api_key</span><span class="p">,</span> <span class="n">api_secret</span><span class="p">)</span>
</code></pre></div>
<blockquote>
<p>Example Response:</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"accountId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"84c7e0d4-a5ed-405f-a655-3ed16ae19997"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"paymentId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"8fe697d4-2c25-482c-aa45-f6cd5a48186d"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"paymentNumber"</span><span class="p">:</span><span class="w"> </span><span class="s2">"14"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"paymentExternalKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"paymentExternalKey"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"authAmount"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="nl">"capturedAmount"</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w">
  </span><span class="nl">"purchasedAmount"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="nl">"refundedAmount"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="nl">"creditedAmount"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="nl">"currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"USD"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"paymentMethodId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"916619a4-02bb-4d3d-b3da-2584ac897b19"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"transactions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"transactionId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"208d38df-8d5a-4e20-89df-15db4b3516b4"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"transactionExternalKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"208d38df-8d5a-4e20-89df-15db4b3516b4"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"paymentId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"8fe697d4-2c25-482c-aa45-f6cd5a48186d"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"paymentExternalKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"paymentExternalKey"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"transactionType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AUTHORIZE"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
      </span><span class="nl">"currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"USD"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"effectiveDate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-07-19T16:39:00.000Z"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"processedAmount"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
      </span><span class="nl">"processedCurrency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"USD"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SUCCESS"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"gatewayErrorCode"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nl">"gatewayErrorMsg"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nl">"firstPaymentReferenceId"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nl">"secondPaymentReferenceId"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nl">"properties"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nl">"auditLogs"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"paymentAttempts"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="nl">"auditLogs"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>Query Parameters</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Required</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>withPluginInfo</strong></td>
<td>boolean</td>
<td>no</td>
<td>false</td>
<td>If true, include plugin info</td>
</tr>
<tr>
<td><strong>withAttempts</strong></td>
<td>boolean</td>
<td>no</td>
<td>false</td>
<td>If true, include payment attempts</td>
</tr>
<tr>
<td><strong>audit</strong></td>
<td>string</td>
<td>no</td>
<td>&quot;NONE&quot;</td>
<td>Level of audit information to return</td>
</tr>
</tbody></table>

<p>Audit information options are &quot;NONE&quot;, &quot;MINIMAL&quot; (only inserts), or &quot;FULL&quot;.</p>

<p><strong>Response</strong></p>

<p>If successful, returns a status code of 200 and a <code>Payment</code> object.</p>

<p><strong>Note:</strong> The <code>effectiveDate</code> of the last payment attempt in <code>SCHEDULED</code> state corresponds to the next scheduled payment retry date and can be used as such.</p>
<h3 id='retrieve-a-payment-using-paymentexternalkey'>Retrieve a payment [using paymentExternalKey]</h3>
<p>Retrieves a Payment object based on its external key given as a query parameter.</p>

<p><strong>HTTP Request</strong> </p>

<p><code>GET http://127.0.0.1:8080/1.0/kb/payments</code></p>

<blockquote>
<p>Example Request:</p>
</blockquote>
<div class="highlight"><pre class="highlight shell tab-shell"><code>curl <span class="se">\</span>
    <span class="nt">-u</span> admin:password <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiKey: bob'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiSecret: lazar'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'Accept: application/json'</span> <span class="se">\</span>
    <span class="s1">'http://127.0.0.1:8080/1.0/kb/payments?externalKey=paymentExternalKey'</span> 
</code></pre></div><div class="highlight"><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">org.killbill.billing.client.api.gen.PaymentApi</span><span class="o">;</span>
<span class="kd">protected</span> <span class="nc">PaymentApi</span> <span class="n">paymentApi</span><span class="o">;</span>

<span class="nc">String</span> <span class="n">externalPaymentKey</span> <span class="o">=</span> <span class="s">"11b28b2e-a377-4b95-b712-d71cbcb28f80"</span><span class="o">;</span>
<span class="nc">Boolean</span> <span class="n">withPluginInfo</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span> <span class="c1">// Will not reflect plugin info</span>
<span class="nc">Boolean</span> <span class="n">withAttempts</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span> <span class="c1">// Will not reflect payment attempts</span>
<span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="no">NULL_PLUGIN_PROPERTIES</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

<span class="nc">Payment</span> <span class="n">payment</span> <span class="o">=</span> <span class="n">paymentApi</span><span class="o">.</span><span class="na">getPaymentByExternalKey</span><span class="o">(</span><span class="n">externalPaymentKey</span><span class="o">,</span>
                                                     <span class="n">withPluginInfo</span><span class="o">,</span> 
                                                     <span class="n">withAttempts</span><span class="o">,</span> 
                                                     <span class="no">NULL_PLUGIN_PROPERTIES</span><span class="o">,</span> 
                                                     <span class="nc">AuditLevel</span><span class="o">.</span><span class="na">NONE</span><span class="o">,</span> 
                                                     <span class="n">requestOptions</span><span class="o">);</span>
</code></pre></div><div class="highlight"><pre class="highlight ruby tab-ruby"><code><span class="n">external_key</span> <span class="o">=</span> <span class="s2">"example_payment_external_key"</span>
<span class="n">with_plugin_info</span> <span class="o">=</span> <span class="kp">false</span>
<span class="n">with_attempts</span> <span class="o">=</span> <span class="kp">false</span>

<span class="no">KillBillClient</span><span class="o">::</span><span class="no">Model</span><span class="o">::</span><span class="no">Payment</span><span class="p">.</span><span class="nf">find_by_external_key</span><span class="p">(</span><span class="n">external_key</span><span class="p">,</span> 
                                                    <span class="n">with_plugin_info</span><span class="p">,</span> 
                                                    <span class="n">with_attempts</span><span class="p">,</span> 
                                                    <span class="n">options</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="n">paymentApi</span> <span class="o">=</span> <span class="n">killbill</span><span class="p">.</span><span class="n">api</span><span class="p">.</span><span class="n">PaymentApi</span><span class="p">()</span>
<span class="n">payment_external_key</span> <span class="o">=</span> <span class="s">'sample_external_key'</span> 

<span class="n">paymentApi</span><span class="p">.</span><span class="n">get_payment_by_external_key</span><span class="p">(</span><span class="n">payment_external_key</span><span class="p">,</span>
                                       <span class="n">api_key</span><span class="p">,</span>
                                       <span class="n">api_secret</span><span class="p">)</span>
</code></pre></div>
<blockquote>
<p>Example Response:</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"accountId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"84c7e0d4-a5ed-405f-a655-3ed16ae19997"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"paymentId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"8fe697d4-2c25-482c-aa45-f6cd5a48186d"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"paymentNumber"</span><span class="p">:</span><span class="w"> </span><span class="s2">"14"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"paymentExternalKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"paymentExternalKey"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"authAmount"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="nl">"capturedAmount"</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w">
  </span><span class="nl">"purchasedAmount"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="nl">"refundedAmount"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="nl">"creditedAmount"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="nl">"currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"USD"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"paymentMethodId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"916619a4-02bb-4d3d-b3da-2584ac897b19"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"transactions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"transactionId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"208d38df-8d5a-4e20-89df-15db4b3516b4"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"transactionExternalKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"208d38df-8d5a-4e20-89df-15db4b3516b4"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"paymentId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"8fe697d4-2c25-482c-aa45-f6cd5a48186d"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"paymentExternalKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"paymentExternalKey"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"transactionType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AUTHORIZE"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
      </span><span class="nl">"currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"USD"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"effectiveDate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-07-19T16:39:00.000Z"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"processedAmount"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
      </span><span class="nl">"processedCurrency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"USD"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SUCCESS"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"gatewayErrorCode"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nl">"gatewayErrorMsg"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nl">"firstPaymentReferenceId"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nl">"secondPaymentReferenceId"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nl">"properties"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nl">"auditLogs"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"paymentAttempts"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="nl">"auditLogs"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>Query Parameters</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Required</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>externalKey</strong></td>
<td>string</td>
<td>yes</td>
<td>none</td>
<td>Payment external key</td>
</tr>
<tr>
<td><strong>withPluginInfo</strong></td>
<td>boolean</td>
<td>no</td>
<td>false</td>
<td>If true, include plugin info</td>
</tr>
<tr>
<td><strong>withAttempts</strong></td>
<td>boolean</td>
<td>no</td>
<td>false</td>
<td>If true, include payment attempts</td>
</tr>
<tr>
<td><strong>audit</strong></td>
<td>string</td>
<td>no</td>
<td>&quot;NONE&quot;</td>
<td>Level of audit information to return</td>
</tr>
</tbody></table>

<p>Audit information options are &quot;NONE&quot;, &quot;MINIMAL&quot; (only inserts), or &quot;FULL&quot;.</p>

<p><strong>Response</strong></p>

<p>If successful, returns a status code of 200 and a <code>Payment</code> object.</p>
<h3 id='complete-an-existing-transaction-using-paymentid'>Complete an existing transaction [using paymentId]</h3>
<p>Completes any existing PaymentTransaction that is in a PENDING state, based on its <code>paymentId</code> given as a path parameter.</p>

<p><strong>HTTP Request</strong> </p>

<p><code>PUT http://127.0.0.1:8080/1.0/kb/payments/{paymentId}</code></p>

<blockquote>
<p>Example Request:</p>
</blockquote>
<div class="highlight"><pre class="highlight shell tab-shell"><code>curl <span class="se">\</span>
    <span class="nt">-X</span> PUT <span class="se">\</span>
    <span class="nt">-u</span> admin:password <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiKey: bob'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiSecret: lazar'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-CreatedBy: demo'</span> <span class="se">\</span>
    <span class="nt">-d</span> <span class="s1">'{ 
            "paymentId": "8fe697d4-2c25-482c-aa45-f6cd5a48186d"
      }'</span> <span class="se">\</span>
    <span class="s1">'http://127.0.0.1:8080/1.0/kb/payments/8fe697d4-2c25-482c-aa45-f6cd5a48186d'</span> 
</code></pre></div><div class="highlight"><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">org.killbill.billing.client.api.gen.PaymentApi</span><span class="o">;</span>
<span class="kd">protected</span> <span class="nc">PaymentApi</span> <span class="n">paymentApi</span><span class="o">;</span>

<span class="no">UUID</span> <span class="n">paymentId</span> <span class="o">=</span> <span class="no">UUID</span><span class="o">.</span><span class="na">fromString</span><span class="o">(</span><span class="s">"cca08349-8b26-41c7-bfcc-2e3cf70a0f28"</span><span class="o">);</span>
<span class="nc">PaymentTransaction</span> <span class="n">body</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PaymentTransaction</span><span class="o">();</span>
<span class="n">body</span><span class="o">.</span><span class="na">setPaymentId</span><span class="o">(</span><span class="n">paymentId</span><span class="o">);</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="no">NULL_PLUGIN_NAMES</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="no">NULL_PLUGIN_PROPERTIES</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

<span class="n">paymentApi</span><span class="o">.</span><span class="na">completeTransaction</span><span class="o">(</span><span class="n">paymentId</span><span class="o">,</span> 
                               <span class="n">body</span><span class="o">,</span> 
                               <span class="no">NULL_PLUGIN_NAMES</span><span class="o">,</span> 
                               <span class="no">NULL_PLUGIN_PROPERTIES</span><span class="o">,</span> 
                               <span class="n">requestOptions</span><span class="o">);</span>
</code></pre></div><div class="highlight"><pre class="highlight ruby tab-ruby"><code><span class="n">transaction</span>            <span class="o">=</span> <span class="no">KillBillClient</span><span class="o">::</span><span class="no">Model</span><span class="o">::</span><span class="no">Transaction</span><span class="p">.</span><span class="nf">new</span>
<span class="n">transaction</span><span class="p">.</span><span class="nf">payment_id</span> <span class="o">=</span> <span class="s2">"7dcda896-808b-414c-aad4-74ddc98e3dcb"</span>
<span class="n">refresh_options</span>        <span class="o">=</span> <span class="kp">nil</span>

<span class="n">transaction</span><span class="p">.</span><span class="nf">complete_initial_transaction</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> 
                                         <span class="n">reason</span><span class="p">,</span> 
                                         <span class="n">comment</span><span class="p">,</span> 
                                         <span class="n">options</span><span class="p">,</span> 
                                         <span class="n">refresh_options</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="n">paymentApi</span> <span class="o">=</span> <span class="n">killbill</span><span class="p">.</span><span class="n">api</span><span class="p">.</span><span class="n">PaymentApi</span><span class="p">()</span>
<span class="n">payment_id</span> <span class="o">=</span> <span class="s">'7dcda896-808b-414c-aad4-74ddc98e3dcb'</span>
<span class="n">body</span> <span class="o">=</span> <span class="n">PaymentTransaction</span><span class="p">(</span><span class="n">payment_id</span><span class="o">=</span><span class="n">payment_id</span><span class="p">)</span>

<span class="n">paymentApi</span><span class="p">.</span><span class="n">complete_transaction</span><span class="p">(</span><span class="n">payment_id</span><span class="p">,</span>
                                <span class="n">body</span><span class="p">,</span>
                                <span class="n">created_by</span><span class="p">,</span>
                                <span class="n">api_key</span><span class="p">,</span>
                                <span class="n">api_secret</span><span class="p">)</span>
</code></pre></div>
<p><strong>Request Body</strong></p>

<p>A PaymentTransaction object containing, at least, the <code>paymentId</code></p>

<p><strong>Query Parameters</strong></p>

<p>None.</p>

<p><strong>Returns</strong></p>

<p>If successful, returns a status code of 204 and an empty body.</p>
<h3 id='complete-an-existing-transaction-using-paymentexternalkey'>Complete an existing transaction [using paymentExternalKey]</h3>
<p>Completes any existing PaymentTransaction that is in a PENDING state, based on its <code>paymentExternalKey</code> given in the request body.</p>

<p><strong>HTTP Request</strong> </p>

<p><code>PUT http://127.0.0.1:8080/1.0/kb/payments</code></p>

<blockquote>
<p>Example Request:</p>
</blockquote>
<div class="highlight"><pre class="highlight shell tab-shell"><code>curl <span class="se">\</span>
    <span class="nt">-X</span> PUT <span class="se">\</span>
    <span class="nt">-u</span> admin:password <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiKey: bob'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiSecret: lazar'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-CreatedBy: demo'</span> <span class="se">\</span>
    <span class="nt">-d</span> <span class="s1">'{
          "paymentExternalKey": "paymentExternalKey"
      }'</span> <span class="se">\</span>
    <span class="s1">'http://127.0.0.1:8080/1.0/kb/payments'</span> 
</code></pre></div><div class="highlight"><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">org.killbill.billing.client.api.gen.PaymentApi</span><span class="o">;</span>
<span class="kd">protected</span> <span class="nc">PaymentApi</span> <span class="n">paymentApi</span><span class="o">;</span>

<span class="nc">String</span> <span class="n">externalPaymentKey</span> <span class="o">=</span> <span class="s">"11b28b2e-a377-4b95-b712-d71cbcb28f80"</span><span class="o">;</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="no">NULL_PLUGIN_NAMES</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="no">NULL_PLUGIN_PROPERTIES</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

<span class="nc">PaymentTransaction</span> <span class="n">body</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PaymentTransaction</span><span class="o">();</span>
<span class="n">body</span><span class="o">.</span><span class="na">setPaymentExternalKey</span><span class="o">(</span><span class="n">externalPaymentKey</span><span class="o">);</span>

<span class="n">paymentApi</span><span class="o">.</span><span class="na">completeTransactionByExternalKey</span><span class="o">(</span><span class="n">body</span><span class="o">,</span> 
                                            <span class="no">NULL_PLUGIN_NAMES</span><span class="o">,</span> 
                                            <span class="no">NULL_PLUGIN_PROPERTIES</span><span class="o">,</span> 
                                            <span class="n">requestOptions</span><span class="o">);</span>
</code></pre></div><div class="highlight"><pre class="highlight ruby tab-ruby"><code><span class="n">transaction</span>                      <span class="o">=</span> <span class="no">KillBillClient</span><span class="o">::</span><span class="no">Model</span><span class="o">::</span><span class="no">Transaction</span><span class="p">.</span><span class="nf">new</span>
<span class="n">transaction</span><span class="p">.</span><span class="nf">payment_external_key</span> <span class="o">=</span> <span class="s2">"example_payment_external_key"</span>
<span class="n">refresh_options</span>                  <span class="o">=</span> <span class="kp">nil</span>

<span class="n">transaction</span><span class="p">.</span><span class="nf">complete_initial_transaction</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> 
                                         <span class="n">reason</span><span class="p">,</span> 
                                         <span class="n">comment</span><span class="p">,</span> 
                                         <span class="n">options</span><span class="p">,</span> 
                                         <span class="n">refresh_options</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="n">paymentApi</span> <span class="o">=</span> <span class="n">killbill</span><span class="p">.</span><span class="n">api</span><span class="p">.</span><span class="n">PaymentApi</span><span class="p">()</span>
<span class="n">payment_external_key</span> <span class="o">=</span> <span class="s">'sample_external_key'</span>
<span class="n">body</span> <span class="o">=</span> <span class="n">PaymentTransaction</span><span class="p">(</span><span class="n">payment_external_key</span><span class="o">=</span><span class="n">payment_external_key</span><span class="p">)</span>

<span class="n">paymentApi</span><span class="p">.</span><span class="n">complete_transaction_by_external_key</span><span class="p">(</span><span class="n">body</span><span class="p">,</span>
                                                <span class="n">created_by</span><span class="p">,</span>
                                                <span class="n">api_key</span><span class="p">,</span>
                                                <span class="n">api_secret</span><span class="p">)</span>
</code></pre></div>
<p><strong>Request Body</strong></p>

<p>A PaymentTransaction object containing, at least, the <code>paymentExternalKey</code></p>

<p><strong>Query Parameters</strong></p>

<p>None.</p>

<p><strong>Returns</strong></p>

<p>If successful, returns a status code of 204 and an empty body.</p>
<h3 id='void-an-existing-payment-using-paymentid'>Void an existing payment [using paymentId]</h3>
<p>Voids a Payment, providing it is in a voidable state. For example, a Payment with only an AUTHORIZE transaction can be voided. No further transactions are possible on a voided Payment. The Payment is identified by its <code>paymentId</code>, which is given as a path parameter.</p>

<p><strong>HTTP Request</strong> </p>

<p><code>DELETE http://127.0.0.1:8080/1.0/kb/payments/{paymentId}</code></p>

<blockquote>
<p>Example Request:</p>
</blockquote>
<div class="highlight"><pre class="highlight shell tab-shell"><code>curl <span class="nt">-v</span> <span class="se">\</span>
    <span class="nt">-X</span> DELETE <span class="se">\</span>
    <span class="nt">-u</span> admin:password <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiKey: bob'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiSecret: lazar'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-CreatedBy: demo'</span> <span class="se">\</span>
    <span class="nt">-d</span> <span class="s1">'{ 
            "paymentId": "8fe697d4-2c25-482c-aa45-f6cd5a48186d"
      }'</span> <span class="se">\ </span>   
    <span class="s1">'http://127.0.0.1:8080/1.0/kb/payments/8fe697d4-2c25-482c-aa45-f6cd5a48186d'</span>    
</code></pre></div><div class="highlight"><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">org.killbill.billing.client.api.gen.PaymentApi</span><span class="o">;</span>
<span class="kd">protected</span> <span class="nc">PaymentApi</span> <span class="n">paymentApi</span><span class="o">;</span>

<span class="no">UUID</span> <span class="n">paymentId</span> <span class="o">=</span> <span class="no">UUID</span><span class="o">.</span><span class="na">fromString</span><span class="o">(</span><span class="s">"cca08349-8b26-41c7-bfcc-2e3cf70a0f28"</span><span class="o">);</span>
<span class="nc">PaymentTransaction</span> <span class="n">body</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PaymentTransaction</span><span class="o">();</span>
<span class="n">body</span><span class="o">.</span><span class="na">setPaymentId</span><span class="o">(</span><span class="n">paymentId</span><span class="o">);</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="no">NULL_PLUGIN_NAMES</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="no">NULL_PLUGIN_PROPERTIES</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

<span class="n">paymentApi</span><span class="o">.</span><span class="na">voidPayment</span><span class="o">(</span><span class="n">paymentId</span><span class="o">,</span> 
                       <span class="n">body</span><span class="o">,</span> 
                       <span class="no">NULL_PLUGIN_NAMES</span><span class="o">,</span> 
                       <span class="no">NULL_PLUGIN_PROPERTIES</span><span class="o">,</span> 
                       <span class="n">requestOptions</span><span class="o">);</span>
</code></pre></div><div class="highlight"><pre class="highlight ruby tab-ruby"><code><span class="n">transaction</span>             <span class="o">=</span> <span class="no">KillBillClient</span><span class="o">::</span><span class="no">Model</span><span class="o">::</span><span class="no">Transaction</span><span class="p">.</span><span class="nf">new</span>
<span class="n">transaction</span><span class="p">.</span><span class="nf">payment_id</span>  <span class="o">=</span> <span class="s2">"29b34a3d-d301-4e57-8fc2-2c0a201c4fd0"</span>

<span class="n">transaction</span><span class="p">.</span><span class="nf">void</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> 
                 <span class="n">reason</span><span class="p">,</span> 
                 <span class="n">comment</span><span class="p">,</span> 
                 <span class="n">options</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="n">paymentApi</span> <span class="o">=</span> <span class="n">killbill</span><span class="p">.</span><span class="n">api</span><span class="p">.</span><span class="n">PaymentApi</span><span class="p">()</span>
<span class="n">payment_id</span> <span class="o">=</span> <span class="s">'29b34a3d-d301-4e57-8fc2-2c0a201c4fd0'</span>
<span class="n">body</span> <span class="o">=</span> <span class="n">PaymentTransaction</span><span class="p">(</span><span class="n">payment_id</span><span class="o">=</span><span class="n">payment_id</span><span class="p">)</span>

<span class="n">paymentApi</span><span class="p">.</span><span class="n">void_payment</span><span class="p">(</span><span class="n">payment_id</span><span class="p">,</span>
                        <span class="n">body</span><span class="p">,</span>
                        <span class="n">created_by</span><span class="p">,</span>
                        <span class="n">api_key</span><span class="p">,</span>
                        <span class="n">api_secret</span><span class="p">)</span>
</code></pre></div>
<p><strong>Request Body</strong></p>

<p>A PaymentTransaction object containing, at least, the <code>paymentId</code></p>

<p><strong>Query Parameters</strong></p>

<p>None.</p>

<p><strong>Returns</strong></p>

<p>If successful, returns a status code of 204 and an empty body. a PaymentTransaction of type VOID is created.</p>
<h3 id='void-an-existing-payment-using-paymentexternalkey'>Void an existing payment [using paymentExternalKey]</h3>
<p>Voids a Payment, providing it is in a voidable state. For example, a Payment with only an AUTHORIZE transaction can be voided. can be voided. No further transactions are possible on a voided payment. The payment is identified by its <code>paymentExternalKey</code>, which is given as a query parameter.</p>

<p><strong>HTTP Request</strong> </p>

<p><code>DELETE http://127.0.0.1:8080/1.0/kb/payments</code></p>

<blockquote>
<p>Example Request:</p>
</blockquote>
<div class="highlight"><pre class="highlight shell tab-shell"><code>curl <span class="nt">-v</span> <span class="se">\</span>
    <span class="nt">-X</span> DELETE <span class="se">\</span>
    <span class="nt">-u</span> admin:password <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiKey: bob'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiSecret: lazar'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-CreatedBy: demo'</span> <span class="se">\</span>
    <span class="nt">-d</span> <span class="s1">'{
          "paymentExternalKey": "paymentExternalKey"
      }'</span> <span class="se">\</span>
    <span class="s1">'http://127.0.0.1:8080/1.0/kb/payments'</span>     
</code></pre></div><div class="highlight"><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">org.killbill.billing.client.api.gen.PaymentApi</span><span class="o">;</span>
<span class="kd">protected</span> <span class="nc">PaymentApi</span> <span class="n">paymentApi</span><span class="o">;</span>

<span class="nc">String</span> <span class="n">paymentExternalKey</span> <span class="o">=</span> <span class="s">"cca08349-8b26-41c7-bfcc-2e3cf70a0f28"</span><span class="o">;</span>
<span class="nc">PaymentTransaction</span> <span class="n">body</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PaymentTransaction</span><span class="o">();</span>
<span class="n">body</span><span class="o">.</span><span class="na">setPaymentExternalKey</span><span class="o">(</span><span class="n">paymentExternalKey</span><span class="o">);</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="no">NULL_PLUGIN_NAMES</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="no">NULL_PLUGIN_PROPERTIES</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

<span class="n">paymentApi</span><span class="o">.</span><span class="na">voidPaymentByExternalKey</span><span class="o">(</span><span class="n">body</span><span class="o">,</span> 
                                    <span class="no">NULL_PLUGIN_NAMES</span><span class="o">,</span> 
                                    <span class="no">NULL_PLUGIN_PROPERTIES</span><span class="o">,</span> 
                                    <span class="n">requestOptions</span><span class="o">);</span>
</code></pre></div><div class="highlight"><pre class="highlight ruby tab-ruby"><code><span class="n">transaction</span>                          <span class="o">=</span> <span class="no">KillBillClient</span><span class="o">::</span><span class="no">Model</span><span class="o">::</span><span class="no">Transaction</span><span class="p">.</span><span class="nf">new</span>
<span class="n">transaction</span><span class="p">.</span><span class="nf">transaction_external_key</span> <span class="o">=</span> <span class="s2">"payment2-121268-void"</span>

<span class="n">transaction</span><span class="p">.</span><span class="nf">void</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> 
                 <span class="n">reason</span><span class="p">,</span> 
                 <span class="n">comment</span><span class="p">,</span> 
                 <span class="n">options</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="n">paymentApi</span> <span class="o">=</span> <span class="n">killbill</span><span class="p">.</span><span class="n">api</span><span class="p">.</span><span class="n">PaymentApi</span><span class="p">()</span>
<span class="n">payment_external_key</span> <span class="o">=</span> <span class="s">'sample_external_key'</span>
<span class="n">body</span> <span class="o">=</span> <span class="n">PaymentTransaction</span><span class="p">(</span><span class="n">payment_external_key</span><span class="o">=</span><span class="n">payment_external_key</span><span class="p">)</span>

<span class="n">paymentApi</span><span class="p">.</span><span class="n">void_payment_by_external_key</span><span class="p">(</span><span class="n">body</span><span class="p">,</span>
                                        <span class="n">created_by</span><span class="p">,</span>
                                        <span class="n">api_key</span><span class="p">,</span>
                                        <span class="n">api_secret</span><span class="p">)</span>
</code></pre></div>
<p><strong>Request Body</strong></p>

<p>A Payment object containing, at least, the <code>paymentExternalKey</code>.</p>

<p><strong>Query Parameters</strong></p>

<p>None.</p>

<p><strong>Returns</strong></p>

<p>If successful, returns a status code of 204 and an empty body. A PaymentTransaction of type VOID is created.</p>
<h3 id='record-a-chargeback-using-paymentid'>Record a chargeback [using paymentId]</h3>
<p>Creates a CHARGEBACK PaymentTransaction for a specified Payment. The Payment is identified by its <code>paymentId</code> given as a path parameter. The captured amount is reduced by the chargeback amount.</p>

<p><strong>HTTP Request</strong> </p>

<p><code>POST http://127.0.0.1:8080/1.0/kb/payments/{paymentId}/chargebacks</code></p>

<blockquote>
<p>Example Request:</p>
</blockquote>
<div class="highlight"><pre class="highlight shell tab-shell"><code>curl <span class="nt">-v</span> <span class="se">\</span>
    <span class="nt">-X</span> POST <span class="se">\</span>
    <span class="nt">-u</span> admin:password <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiKey: bob'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiSecret: lazar'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-CreatedBy: demo'</span> <span class="se">\</span>
    <span class="nt">-d</span> <span class="s1">'{
          "amount": 5
        }'</span> <span class="se">\</span>
    <span class="s1">'http://127.0.0.1:8080/1.0/kb/payments/8fe697d4-2c25-482c-aa45-f6cd5a48186d/chargebacks'</span> 
</code></pre></div><div class="highlight"><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">org.killbill.billing.client.api.gen.PaymentApi</span><span class="o">;</span>
<span class="kd">protected</span> <span class="nc">PaymentApi</span> <span class="n">paymentApi</span><span class="o">;</span>

<span class="no">UUID</span> <span class="n">paymentId</span> <span class="o">=</span> <span class="no">UUID</span><span class="o">.</span><span class="na">fromString</span><span class="o">(</span><span class="s">"8a096f10-1591-4546-880d-f6d4f7ea818c"</span><span class="o">);</span>
<span class="nc">PaymentTransaction</span> <span class="n">body</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PaymentTransaction</span><span class="o">();</span>
<span class="n">body</span><span class="o">.</span><span class="na">setAmount</span><span class="o">(</span><span class="k">new</span> <span class="nc">BigDecimal</span><span class="o">(</span><span class="mi">5</span><span class="o">));</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="no">NULL_PLUGIN_NAMES</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="no">NULL_PLUGIN_PROPERTIES</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

<span class="nc">Payment</span> <span class="n">payment</span> <span class="o">=</span> <span class="n">paymentApi</span><span class="o">.</span><span class="na">chargebackPayment</span><span class="o">(</span><span class="n">paymentId</span><span class="o">,</span> <span class="n">body</span><span class="o">,</span> <span class="no">NULL_PLUGIN_NAMES</span><span class="o">,</span> <span class="no">NULL_PLUGIN_PROPERTIES</span><span class="o">,</span> <span class="n">requestOptions</span><span class="o">);</span>
</code></pre></div><div class="highlight"><pre class="highlight ruby tab-ruby"><code><span class="n">transaction</span>                <span class="o">=</span> <span class="no">KillBillClient</span><span class="o">::</span><span class="no">Model</span><span class="o">::</span><span class="no">Transaction</span><span class="p">.</span><span class="nf">new</span>
<span class="n">transaction</span><span class="p">.</span><span class="nf">payment_id</span>     <span class="o">=</span> <span class="s2">"42ab1653-051f-416c-8c70-bf5d4061d4fa"</span>
<span class="n">transaction</span><span class="p">.</span><span class="nf">amount</span>         <span class="o">=</span> <span class="s1">'50.0'</span>
<span class="n">transaction</span><span class="p">.</span><span class="nf">currency</span>       <span class="o">=</span> <span class="s1">'USD'</span>
<span class="n">transaction</span><span class="p">.</span><span class="nf">effective_date</span> <span class="o">=</span> <span class="kp">nil</span>
<span class="n">refresh_options</span>            <span class="o">=</span> <span class="kp">nil</span>

<span class="n">transaction</span><span class="p">.</span><span class="nf">chargeback</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> 
                       <span class="n">reason</span><span class="p">,</span> 
                       <span class="n">comment</span><span class="p">,</span> 
                       <span class="n">options</span><span class="p">,</span> 
                       <span class="n">refresh_options</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="n">paymentApi</span> <span class="o">=</span> <span class="n">killbill</span><span class="p">.</span><span class="n">api</span><span class="p">.</span><span class="n">PaymentApi</span><span class="p">()</span>
<span class="n">payment_id</span> <span class="o">=</span> <span class="s">'42ab1653-051f-416c-8c70-bf5d4061d4fa'</span>
<span class="n">body</span> <span class="o">=</span> <span class="n">PaymentTransaction</span><span class="p">(</span><span class="n">payment_id</span><span class="o">=</span><span class="n">payment_id</span><span class="p">,</span>
                          <span class="n">amount</span><span class="o">=</span><span class="mf">50.0</span><span class="p">,</span>
                          <span class="n">currency</span><span class="o">=</span><span class="s">'USD'</span><span class="p">,</span>
                          <span class="n">effective_date</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>

<span class="n">paymentApi</span><span class="p">.</span><span class="n">chargeback_payment</span><span class="p">(</span><span class="n">payment_id</span><span class="p">,</span>
                              <span class="n">body</span><span class="p">,</span>
                              <span class="n">created_by</span><span class="p">,</span>
                              <span class="n">api_key</span><span class="p">,</span>
                              <span class="n">api_secret</span><span class="p">)</span>
</code></pre></div>
<p><strong>Request Body</strong></p>

<p>A Payment Transaction object containing, at least, the <code>amount</code>.</p>

<p><strong>Query Parameters</strong></p>

<p>None.</p>

<p><strong>Returns</strong></p>

<p>If successful, returns a status code of 204 and an empty body. A Payment Transaction is created with type CHARGEBACK.</p>
<h3 id='record-a-chargeback-using-paymentexternalkey'>Record a chargeback [using paymentExternalKey]</h3>
<p>Creates a CHARGEBACK PaymentTransaction for a specified Payment. The Payment is identified by its <code>paymentExternalKey</code> given in the request body. The captured amount is reduced by the chargeback amount.</p>

<p><strong>HTTP Request</strong> </p>

<p><code>POST http://127.0.0.1:8080/1.0/kb/payments/chargebacks</code></p>

<blockquote>
<p>Example Request:</p>
</blockquote>
<div class="highlight"><pre class="highlight shell tab-shell"><code>curl <span class="nt">-v</span> <span class="se">\</span>
    <span class="nt">-X</span> POST <span class="se">\</span>
    <span class="nt">-u</span> admin:password <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiKey: bob'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiSecret: lazar'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-CreatedBy: demo'</span> <span class="se">\</span>
    <span class="nt">-d</span> <span class="s1">'{
          "paymentExternalKey": "a187746f-841a-481c-8d6c-4497080ed968",
          "amount": 5,
          "currency": "USD"
        }'</span> <span class="se">\</span>
    <span class="s1">'http://127.0.0.1:8080/1.0/kb/payments/chargebacks'</span> 
</code></pre></div><div class="highlight"><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">org.killbill.billing.client.api.gen.PaymentApi</span><span class="o">;</span>
<span class="kd">protected</span> <span class="nc">PaymentApi</span> <span class="n">paymentApi</span><span class="o">;</span>

<span class="nc">PaymentTransaction</span> <span class="n">body</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PaymentTransaction</span><span class="o">();</span>
<span class="n">body</span><span class="o">.</span><span class="na">setPaymentExternalKey</span><span class="o">(</span><span class="s">"a975f7b8-1e59-4801-91c9-fcce1526b019"</span><span class="o">);</span>
<span class="n">body</span><span class="o">.</span><span class="na">setAmount</span><span class="o">(</span><span class="k">new</span> <span class="nc">BigDecimal</span><span class="o">(</span><span class="mi">5</span><span class="o">));</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="no">NULL_PLUGIN_NAMES</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="no">NULL_PLUGIN_PROPERTIES</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

<span class="nc">Payment</span> <span class="n">payment</span> <span class="o">=</span> <span class="n">paymentApi</span><span class="o">.</span><span class="na">chargebackPaymentByExternalKey</span><span class="o">(</span><span class="n">body</span><span class="o">,</span> <span class="no">NULL_PLUGIN_NAMES</span><span class="o">,</span> <span class="no">NULL_PLUGIN_PROPERTIES</span><span class="o">,</span> <span class="n">requestOptions</span><span class="o">);</span>

</code></pre></div><div class="highlight"><pre class="highlight ruby tab-ruby"><code><span class="n">transaction</span>                      <span class="o">=</span> <span class="no">KillBillClient</span><span class="o">::</span><span class="no">Model</span><span class="o">::</span><span class="no">Transaction</span><span class="p">.</span><span class="nf">new</span>
<span class="n">transaction</span><span class="p">.</span><span class="nf">payment_external_key</span> <span class="o">=</span> <span class="s2">"example_payment_external_key"</span>
<span class="n">transaction</span><span class="p">.</span><span class="nf">amount</span>               <span class="o">=</span> <span class="s1">'50.0'</span>
<span class="n">transaction</span><span class="p">.</span><span class="nf">currency</span>             <span class="o">=</span> <span class="s1">'USD'</span>
<span class="n">transaction</span><span class="p">.</span><span class="nf">effective_date</span>       <span class="o">=</span> <span class="kp">nil</span>
<span class="n">refresh_options</span>                  <span class="o">=</span> <span class="kp">nil</span>

<span class="n">transaction</span><span class="p">.</span><span class="nf">chargeback</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> 
                       <span class="n">reason</span><span class="p">,</span> 
                       <span class="n">comment</span><span class="p">,</span> 
                       <span class="n">options</span><span class="p">,</span> 
                       <span class="n">refresh_options</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="n">paymentApi</span> <span class="o">=</span> <span class="n">killbill</span><span class="p">.</span><span class="n">api</span><span class="p">.</span><span class="n">PaymentApi</span><span class="p">()</span>
<span class="n">payment_external_key</span> <span class="o">=</span> <span class="s">'sample_external_key'</span>
<span class="n">body</span> <span class="o">=</span> <span class="n">PaymentTransaction</span><span class="p">(</span><span class="n">payment_external_key</span><span class="o">=</span><span class="n">payment_external_key</span><span class="p">,</span>
                          <span class="n">amount</span><span class="o">=</span><span class="mf">50.0</span><span class="p">,</span>
                          <span class="n">currency</span><span class="o">=</span><span class="s">'USD'</span><span class="p">,</span>
                          <span class="n">effective_date</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>

<span class="n">paymentApi</span><span class="p">.</span><span class="n">chargeback_payment_by_external_key</span><span class="p">(</span><span class="n">body</span><span class="p">,</span>
                                              <span class="n">created_by</span><span class="p">,</span>
                                              <span class="n">api_key</span><span class="p">,</span>
                                              <span class="n">api_secret</span><span class="p">)</span>
</code></pre></div>
<p><strong>Request Body</strong></p>

<p>A PaymentTransaction object containing, at least, the <code>paymentExternalKey</code> and the <code>amount</code>.</p>

<p><strong>Query Parameters</strong></p>

<p>None.</p>

<p><strong>Returns</strong></p>

<p>If successful, returns a status code of 204 and an empty body. A PaymentTransaction is created with type CHARGEBACK.</p>
<h3 id='record-a-chargeback-reversal-using-paymentid'>Record a chargeback reversal [using paymentId]</h3>
<p>Reverses a CHARGEBACK PaymentTransaction, if permitted by the Payment plugin. The chargeback amount is added back to the captured amount. The payment is identified by its <code>paymentId</code> which is given as a path parameter. The CHARGEBACK transaction is identified by its <code>transactionExternalKey</code> which is given in the request body.</p>

<p><strong>HTTP Request</strong> </p>

<p><code>POST http://127.0.0.1:8080/1.0/kb/payments/{paymentId}/chargebackReversals</code></p>

<blockquote>
<p>Example Request:</p>
</blockquote>
<div class="highlight"><pre class="highlight shell tab-shell"><code>curl <span class="nt">-v</span> <span class="se">\</span>
    <span class="nt">-X</span> POST <span class="se">\</span>
    <span class="nt">-u</span> admin:password <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiKey: bob'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiSecret: lazar'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-CreatedBy: demo'</span> <span class="se">\</span>
    <span class="nt">-d</span> <span class="s1">'{
          "transactionExternalKey": "7ff346e8-24cc-4437-acfa-c79d96d54ee2"
        }'</span> <span class="se">\</span>
    <span class="s1">'http://127.0.0.1:8080/1.0/kb/payments/8fe697d4-2c25-482c-aa45-f6cd5a48186d/chargebackReversals'</span> 
</code></pre></div><div class="highlight"><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">org.killbill.billing.client.api.gen.PaymentApi</span><span class="o">;</span>
<span class="kd">protected</span> <span class="nc">PaymentApi</span> <span class="n">paymentApi</span><span class="o">;</span>

<span class="nc">PaymentTransaction</span> <span class="n">body</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PaymentTransaction</span><span class="o">();</span>
<span class="n">body</span><span class="o">.</span><span class="na">setPaymentExternalKey</span><span class="o">(</span><span class="s">"a975f7b8-1e59-4801-91c9-fcce1526b019"</span><span class="o">);</span>
<span class="n">body</span><span class="o">.</span><span class="na">setAmount</span><span class="o">(</span><span class="k">new</span> <span class="nc">BigDecimal</span><span class="o">(</span><span class="mi">5</span><span class="o">));</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="no">NULL_PLUGIN_NAMES</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="no">NULL_PLUGIN_PROPERTIES</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

<span class="nc">Payment</span> <span class="n">payment</span> <span class="o">=</span> <span class="n">paymentApi</span><span class="o">.</span><span class="na">chargebackPaymentByExternalKey</span><span class="o">(</span><span class="n">body</span><span class="o">,</span> <span class="no">NULL_PLUGIN_NAMES</span><span class="o">,</span> <span class="no">NULL_PLUGIN_PROPERTIES</span><span class="o">,</span> <span class="n">requestOptions</span><span class="o">);</span>
</code></pre></div><div class="highlight"><pre class="highlight ruby tab-ruby"><code><span class="n">transaction</span>                          <span class="o">=</span> <span class="no">KillBillClient</span><span class="o">::</span><span class="no">Model</span><span class="o">::</span><span class="no">Transaction</span><span class="p">.</span><span class="nf">new</span>
<span class="n">transaction</span><span class="p">.</span><span class="nf">transaction_external_key</span> <span class="o">=</span> <span class="s2">"9ceb96a2-5407-482b-8847-7b08cc64213f"</span>
<span class="n">transaction</span><span class="p">.</span><span class="nf">payment_id</span>               <span class="o">=</span> <span class="s2">"74a82e25-120a-4a39-a7f7-7b5c2b4ac05d"</span>

<span class="n">transaction</span><span class="p">.</span><span class="nf">chargeback_reversals</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> 
                                 <span class="n">reason</span><span class="p">,</span> 
                                 <span class="n">comment</span><span class="p">,</span> 
                                 <span class="n">options</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="n">paymentApi</span> <span class="o">=</span> <span class="n">killbill</span><span class="p">.</span><span class="n">api</span><span class="p">.</span><span class="n">PaymentApi</span><span class="p">()</span>
<span class="n">payment_id</span> <span class="o">=</span> <span class="s">'74a82e25-120a-4a39-a7f7-7b5c2b4ac05d'</span>
<span class="n">transaction_external_key</span> <span class="o">=</span> <span class="s">'9ceb96a2-5407-482b-8847-7b08cc64213f'</span>
<span class="n">body</span> <span class="o">=</span> <span class="n">PaymentTransaction</span><span class="p">(</span><span class="n">payment_id</span><span class="o">=</span><span class="n">payment_id</span><span class="p">,</span>
                          <span class="n">transaction_external_key</span><span class="o">=</span><span class="n">transaction_external_key</span><span class="p">)</span>

<span class="n">paymentApi</span><span class="p">.</span><span class="n">chargeback_reversal_payment</span><span class="p">(</span><span class="n">payment_id</span><span class="p">,</span>
                                       <span class="n">body</span><span class="p">,</span>
                                       <span class="n">created_by</span><span class="p">,</span>
                                       <span class="n">api_key</span><span class="p">,</span>
                                       <span class="n">api_secret</span><span class="p">)</span>
</code></pre></div>
<p><strong>Request Body</strong></p>

<p>A PaymentTransaction object containing, at least, the <code>transactionExternalKey</code>.</p>

<p><strong>Query Parameters</strong></p>

<p>None.</p>

<p><strong>Response</strong></p>

<p>If successful, returns a status code of 201 and an empty body.</p>
<h3 id='record-a-chargeback-reversal-using-paymentexternalkey'>Record a chargeback reversal [using paymentExternalKey]</h3>
<p>Reverses a CHARGEBACK PaymentTransaction, if permitted by the Payment plugin. The chargeback amount is added back to the captured amount. The Payment is identified by its <code>paymentExternalKey</code> which is given in the request body. The CHARGEBACK transaction is identified by its <code>transactionExternalKey</code> which is also given in the request body.</p>

<p><strong>HTTP Request</strong> </p>

<p><code>POST http://127.0.0.1:8080/1.0/kb/payments/chargebackReversals</code></p>

<blockquote>
<p>Example Request:</p>
</blockquote>
<div class="highlight"><pre class="highlight shell tab-shell"><code>curl <span class="nt">-v</span> <span class="se">\</span>
    <span class="nt">-X</span> POST <span class="se">\</span>
    <span class="nt">-u</span> admin:password <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiKey: bob'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiSecret: lazar'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-CreatedBy: demo'</span> <span class="se">\</span>
    <span class="nt">-d</span> <span class="s1">'{
          "transactionExternalKey": "7ff346e8-24cc-4437-acfa-c79d96d54ee2",
          "paymentExternalKey": "paymentExternalKey"
        }'</span> <span class="se">\</span>
    <span class="s1">'http://127.0.0.1:8080/1.0/kb/payments/chargebackReversals'</span> 
</code></pre></div><div class="highlight"><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">org.killbill.billing.client.api.gen.PaymentApi</span><span class="o">;</span>
<span class="kd">protected</span> <span class="nc">PaymentApi</span> <span class="n">paymentApi</span><span class="o">;</span>

<span class="nc">PaymentTransaction</span> <span class="n">body</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PaymentTransaction</span><span class="o">();</span>
<span class="n">body</span><span class="o">.</span><span class="na">setPaymentExternalKey</span><span class="o">(</span><span class="s">"631ec4ac-d745-4457-939d-d761badbf0ad"</span><span class="o">);</span>
<span class="n">body</span><span class="o">.</span><span class="na">setTransactionExternalKey</span><span class="o">(</span><span class="s">"72789509-2b94-43b6-b889-42c5ec5d27f3"</span><span class="o">);</span>
<span class="n">body</span><span class="o">.</span><span class="na">setAmount</span><span class="o">(</span><span class="k">new</span> <span class="nc">BigDecimal</span><span class="o">(</span><span class="mi">10</span><span class="o">));</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="no">NULL_PLUGIN_NAMES</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="no">NULL_PLUGIN_PROPERTIES</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

<span class="nc">Payment</span> <span class="n">payment</span> <span class="o">=</span> <span class="n">paymentApi</span><span class="o">.</span><span class="na">chargebackPaymentByExternalKey</span><span class="o">(</span><span class="n">body</span><span class="o">,</span> <span class="no">NULL_PLUGIN_NAMES</span><span class="o">,</span> <span class="no">NULL_PLUGIN_PROPERTIES</span><span class="o">,</span> <span class="n">requestOptions</span><span class="o">);</span>
</code></pre></div><div class="highlight"><pre class="highlight ruby tab-ruby"><code><span class="n">transaction</span>                      <span class="o">=</span> <span class="no">KillBillClient</span><span class="o">::</span><span class="no">Model</span><span class="o">::</span><span class="no">Transaction</span><span class="p">.</span><span class="nf">new</span>
<span class="n">transaction</span><span class="p">.</span><span class="nf">payment_external_key</span> <span class="o">=</span> <span class="s2">"example_payment_external_key"</span>

<span class="n">transaction</span><span class="p">.</span><span class="nf">chargeback_reversals</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> 
                                 <span class="n">reason</span><span class="p">,</span> 
                                 <span class="n">comment</span><span class="p">,</span> 
                                 <span class="n">options</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="n">paymentApi</span> <span class="o">=</span> <span class="n">killbill</span><span class="p">.</span><span class="n">api</span><span class="p">.</span><span class="n">PaymentApi</span><span class="p">()</span>
<span class="n">body</span> <span class="o">=</span> <span class="n">PaymentTransaction</span><span class="p">(</span><span class="n">payment_external_key</span><span class="o">=</span><span class="n">payment_external_key</span><span class="p">,</span>
                          <span class="n">transaction_external_key</span><span class="o">=</span><span class="n">transaction_external_key</span><span class="p">)</span>

<span class="n">paymentApi</span><span class="p">.</span><span class="n">chargeback_reversal_payment_by_external_key</span><span class="p">(</span><span class="n">body</span><span class="p">,</span>
                                                       <span class="n">created_by</span><span class="p">,</span>
                                                       <span class="n">api_key</span><span class="p">,</span>
                                                       <span class="n">api_secret</span><span class="p">)</span>
</code></pre></div>
<p><strong>Request Body</strong></p>

<p>A PaymentTransaction object containing, at least, the <code>paymentExternalKey</code> and the <code>TransactionExternalKey</code>.</p>

<p><strong>Query Parameters</strong></p>

<p>None.</p>

<p><strong>Response</strong></p>

<p>If successful, returns a status code of 201 and an empty body.</p>
<h3 id='refund-an-existing-payment-using-paymentid'>Refund an existing payment [using paymentId]</h3>
<p>Refunds part or all of the balance of an existing Payment. The Payment is identified by its <code>paymentId</code>, which is given as a path parameter. </p>

<p><strong>HTTP Request</strong> </p>

<p><code>POST http://127.0.0.1:8080/1.0/kb/payments/{paymentId}/refunds</code></p>

<blockquote>
<p>Example Request:</p>
</blockquote>
<div class="highlight"><pre class="highlight shell tab-shell"><code>curl <span class="nt">-v</span> <span class="se">\</span>
    <span class="nt">-X</span> POST <span class="se">\</span>
    <span class="nt">-u</span> admin:password <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiKey: bob'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiSecret: lazar'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-CreatedBy: demo'</span> <span class="se">\</span>
    <span class="nt">-d</span> <span class="s1">'{
          "amount": 5
        }'</span> <span class="se">\</span>
    <span class="s1">'http://127.0.0.1:8080/1.0/kb/payments/8fe697d4-2c25-482c-aa45-f6cd5a48186d/refunds'</span> 
</code></pre></div><div class="highlight"><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">org.killbill.billing.client.api.gen.PaymentApi</span><span class="o">;</span>
<span class="kd">protected</span> <span class="nc">PaymentApi</span> <span class="n">paymentApi</span><span class="o">;</span>

<span class="no">UUID</span> <span class="n">paymentId</span> <span class="o">=</span> <span class="no">UUID</span><span class="o">.</span><span class="na">fromString</span><span class="o">(</span><span class="s">"89614849-9bd6-43ba-93d0-e9deb1acf575"</span><span class="o">);</span>

<span class="nc">PaymentTransaction</span> <span class="n">body</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PaymentTransaction</span><span class="o">();</span>
<span class="n">body</span><span class="o">.</span><span class="na">setPaymentId</span><span class="o">(</span><span class="n">paymentId</span><span class="o">);</span>
<span class="n">body</span><span class="o">.</span><span class="na">setAmount</span><span class="o">(</span><span class="nc">BigDecimal</span><span class="o">.</span><span class="na">TEN</span><span class="o">);</span>
<span class="n">body</span><span class="o">.</span><span class="na">setCurrency</span><span class="o">(</span><span class="nc">Currency</span><span class="o">.</span><span class="na">USD</span><span class="o">);</span>
<span class="n">body</span><span class="o">.</span><span class="na">setPaymentExternalKey</span><span class="o">(</span><span class="s">"de924e98-2c76-4e90-b9d6-2ced262bc251"</span><span class="o">);</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="no">NULL_PLUGIN_NAMES</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="no">NULL_PLUGIN_PROPERTIES</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

<span class="nc">Payment</span> <span class="n">refundPayment</span> <span class="o">=</span> <span class="n">paymentApi</span><span class="o">.</span><span class="na">refundPayment</span><span class="o">(</span><span class="n">paymentId</span><span class="o">,</span> 
                                                 <span class="n">body</span><span class="o">,</span> 
                                                 <span class="no">NULL_PLUGIN_NAMES</span><span class="o">,</span> 
                                                 <span class="no">NULL_PLUGIN_PROPERTIES</span><span class="o">,</span> 
                                                 <span class="n">requestOptions</span><span class="o">);</span>
</code></pre></div><div class="highlight"><pre class="highlight ruby tab-ruby"><code><span class="n">transaction</span>            <span class="o">=</span> <span class="no">KillBillClient</span><span class="o">::</span><span class="no">Model</span><span class="o">::</span><span class="no">Transaction</span><span class="p">.</span><span class="nf">new</span>
<span class="n">transaction</span><span class="p">.</span><span class="nf">payment_id</span> <span class="o">=</span> <span class="s2">"dce5b2a0-0f0f-430b-9427-545ba4be5c7f"</span>
<span class="n">transaction</span><span class="p">.</span><span class="nf">amount</span>     <span class="o">=</span> <span class="s1">'50.0'</span>
<span class="n">refresh_options</span>        <span class="o">=</span> <span class="kp">nil</span>

<span class="n">transaction</span><span class="p">.</span><span class="nf">refund</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> 
                   <span class="n">reason</span><span class="p">,</span> 
                   <span class="n">comment</span><span class="p">,</span> 
                   <span class="n">options</span><span class="p">,</span> 
                   <span class="n">refresh_options</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="n">paymentApi</span> <span class="o">=</span> <span class="n">killbill</span><span class="p">.</span><span class="n">api</span><span class="p">.</span><span class="n">PaymentApi</span><span class="p">()</span>
<span class="n">payment_id</span> <span class="o">=</span> <span class="s">'dce5b2a0-0f0f-430b-9427-545ba4be5c7f'</span> 
<span class="n">body</span> <span class="o">=</span> <span class="n">PaymentTransaction</span><span class="p">(</span><span class="n">payment_id</span><span class="o">=</span><span class="n">payment_id</span><span class="p">,</span>
                          <span class="n">amount</span><span class="o">=</span><span class="mf">50.0</span><span class="p">)</span>

<span class="n">paymentApi</span><span class="p">.</span><span class="n">refund_payment</span><span class="p">(</span><span class="n">payment_id</span><span class="p">,</span>
                          <span class="n">body</span><span class="p">,</span>
                          <span class="n">created_by</span><span class="p">,</span>
                          <span class="n">api_key</span><span class="p">,</span>
                          <span class="n">api_secret</span><span class="p">)</span>
</code></pre></div>
<p><strong>Request Body</strong></p>

<p>A PaymentTransaction object including, as a minimum, the <code>amount</code> to be refunded.</p>

<p><strong>Query Parameters</strong></p>

<p>None. </p>

<p><strong>Returns</strong></p>

<p>If successful, returns a status code of 201 and an empty body. In addition, a Location header containing the payment id is returned. A new PaymentTransaction of type <code>REFUND</code> is created.</p>
<h3 id='refund-an-existing-payment-using-paymentexternalkey'>Refund an existing payment [using paymentExternalKey]</h3>
<p>Refunds part or all of the balance of an existing payment. The payment is identified by its <code>paymentExternalKey</code>, which is given in the request body.</p>

<p><strong>HTTP Request</strong> </p>

<p><code>POST http://127.0.0.1:8080/1.0/kb/payments/refunds</code></p>

<blockquote>
<p>Example Request:</p>
</blockquote>
<div class="highlight"><pre class="highlight shell tab-shell"><code>curl <span class="nt">-v</span> <span class="se">\</span>
    <span class="nt">-X</span> POST <span class="se">\</span>
    <span class="nt">-u</span> admin:password <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiKey: bob'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiSecret: lazar'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-CreatedBy: demo'</span> <span class="se">\</span>
    <span class="nt">-d</span> <span class="s1">'{
          "paymentExternalKey": "paymentExternalKey",
          "amount": 5,
          "currency": "USD"
        }'</span> <span class="se">\</span>
    <span class="s1">'http://127.0.0.1:8080/1.0/kb/payments/refunds'</span> 
</code></pre></div><div class="highlight"><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">org.killbill.billing.client.api.gen.PaymentApi</span><span class="o">;</span>
<span class="kd">protected</span> <span class="nc">PaymentApi</span> <span class="n">paymentApi</span><span class="o">;</span>

<span class="nc">PaymentTransaction</span> <span class="n">body</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PaymentTransaction</span><span class="o">();</span>
<span class="n">body</span><span class="o">.</span><span class="na">setAmount</span><span class="o">(</span><span class="k">new</span> <span class="nc">BigDecimal</span><span class="o">(</span><span class="mi">2</span><span class="o">));</span>
<span class="n">body</span><span class="o">.</span><span class="na">setCurrency</span><span class="o">(</span><span class="nc">Currency</span><span class="o">.</span><span class="na">USD</span><span class="o">);</span>
<span class="n">body</span><span class="o">.</span><span class="na">setPaymentExternalKey</span><span class="o">(</span><span class="s">"da96999c-b1ac-470f-8c48-c4ecf386cd89"</span><span class="o">);</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="no">NULL_PLUGIN_NAMES</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="no">NULL_PLUGIN_PROPERTIES</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

<span class="nc">Payment</span> <span class="n">refundPayment</span> <span class="o">=</span> <span class="n">paymentApi</span><span class="o">.</span><span class="na">refundPaymentByExternalKey</span><span class="o">(</span><span class="n">body</span><span class="o">,</span> <span class="no">NULL_PLUGIN_NAMES</span><span class="o">,</span> <span class="no">NULL_PLUGIN_PROPERTIES</span><span class="o">,</span> <span class="n">requestOptions</span><span class="o">);</span>

</code></pre></div><div class="highlight"><pre class="highlight ruby tab-ruby"><code><span class="n">transaction</span>                      <span class="o">=</span> <span class="no">KillBillClient</span><span class="o">::</span><span class="no">Model</span><span class="o">::</span><span class="no">Transaction</span><span class="p">.</span><span class="nf">new</span>
<span class="n">transaction</span><span class="p">.</span><span class="nf">payment_external_key</span> <span class="o">=</span> <span class="s2">"example_payment_external_key"</span>
<span class="n">transaction</span><span class="p">.</span><span class="nf">amount</span>               <span class="o">=</span> <span class="s1">'50.0'</span>
<span class="n">refresh_options</span>                  <span class="o">=</span> <span class="kp">nil</span>

<span class="n">transaction</span><span class="p">.</span><span class="nf">refund_by_external_key</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> 
                                   <span class="n">reason</span><span class="p">,</span> 
                                   <span class="n">comment</span><span class="p">,</span> 
                                   <span class="n">options</span><span class="p">,</span> 
                                   <span class="n">refresh_options</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="n">paymentApi</span> <span class="o">=</span> <span class="n">killbill</span><span class="p">.</span><span class="n">api</span><span class="p">.</span><span class="n">PaymentApi</span><span class="p">()</span>
<span class="n">payment_external_key</span> <span class="o">=</span> <span class="s">'example_payment_external_key'</span>
<span class="n">body</span> <span class="o">=</span> <span class="n">PaymentTransaction</span><span class="p">(</span><span class="n">payment_external_key</span><span class="o">=</span><span class="n">payment_external_key</span><span class="p">,</span>
                          <span class="n">amount</span><span class="o">=</span><span class="mf">50.0</span><span class="p">)</span>

<span class="n">paymentApi</span><span class="p">.</span><span class="n">refund_payment_by_external_key</span><span class="p">(</span><span class="n">body</span><span class="p">,</span>
                                          <span class="n">created_by</span><span class="p">,</span>
                                          <span class="n">api_key</span><span class="p">,</span>
                                          <span class="n">api_secret</span><span class="p">)</span>
</code></pre></div>
<p><strong>Request Body</strong></p>

<p>A PaymentTransaction object including, as a minimum, the <code>paymentExternalKey</code> and the <code>amount</code> to be refunded.</p>

<p><strong>Query Parameters</strong></p>

<p>None. </p>

<p><strong>Returns</strong></p>

<p>If successful, returns a status code of 201 and an empty body. In addition, a Location header containing the payment id is returned. A new PaymentTransaction of type <code>REFUND</code> is created.</p>
<h3 id='cancel-a-scheduled-payment-attempt-retry-using-transactionid'>Cancel a scheduled payment attempt retry [using transactionId]</h3>
<p>Cancels a scheduled attempt to retry a PaymentTransaction. The transaction is identified by its <code>transactionId</code>, which is provided as a path parameter.</p>

<p><strong>HTTP Request</strong> </p>

<p><code>DELETE http://127.0.0.1:8080/1.0/kb/payments/{paymentTransactionId}/cancelScheduledPaymentTransaction</code></p>

<blockquote>
<p>Example Request:</p>
</blockquote>
<div class="highlight"><pre class="highlight shell tab-shell"><code>curl <span class="nt">-v</span> <span class="se">\</span>
    <span class="nt">-X</span> DELETE <span class="se">\</span>
    <span class="nt">-u</span> admin:password <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiKey: bob'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiSecret: lazar'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-CreatedBy: demo'</span> <span class="se">\</span>
    <span class="s1">'http://127.0.0.1:8080/1.0/kb/payments/208d38df-8d5a-4e20-89df-15db4b3516b4/cancelScheduledPaymentTransaction'</span>  
</code></pre></div><div class="highlight"><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">org.killbill.billing.client.api.gen.PaymentApi</span><span class="o">;</span>
<span class="kd">protected</span> <span class="nc">PaymentApi</span> <span class="n">paymentApi</span><span class="o">;</span>

<span class="no">UUID</span> <span class="n">paymentTransactionId</span> <span class="o">=</span> <span class="no">UUID</span><span class="o">.</span><span class="na">fromString</span><span class="o">(</span><span class="s">"54aed1ed-f8dc-4445-a19f-3a2519c1a334"</span><span class="o">);</span>
<span class="n">paymentApi</span><span class="o">.</span><span class="na">cancelScheduledPaymentTransactionById</span><span class="o">(</span><span class="n">paymentTransactionId</span><span class="o">,</span> <span class="n">requestOptions</span><span class="o">);</span>

</code></pre></div><div class="highlight"><pre class="highlight ruby tab-ruby"><code><span class="n">transaction</span>                <span class="o">=</span> <span class="no">KillBillClient</span><span class="o">::</span><span class="no">Model</span><span class="o">::</span><span class="no">Transaction</span><span class="p">.</span><span class="nf">new</span>
<span class="n">transaction</span><span class="p">.</span><span class="nf">transaction_id</span> <span class="o">=</span> <span class="s2">"231d2bbc-7ce3-4946-b6d9-f24f9a25ff6c"</span>

<span class="n">transaction</span><span class="p">.</span><span class="nf">cancel_scheduled_payment</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> 
                                     <span class="n">reason</span><span class="p">,</span> 
                                     <span class="n">comment</span><span class="p">,</span> 
                                     <span class="n">options</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="n">paymentApi</span> <span class="o">=</span> <span class="n">killbill</span><span class="p">.</span><span class="n">api</span><span class="p">.</span><span class="n">PaymentApi</span><span class="p">()</span>
<span class="n">payment_transaction_id</span> <span class="o">=</span> <span class="s">'231d2bbc-7ce3-4946-b6d9-f24f9a25ff6c'</span>

<span class="n">paymentApi</span><span class="p">.</span><span class="n">cancel_scheduled_payment_transaction_by_id</span><span class="p">(</span><span class="n">payment_transaction_id</span><span class="p">,</span>
                                                      <span class="n">created_by</span><span class="p">,</span>
                                                      <span class="n">api_key</span><span class="p">,</span>
                                                      <span class="n">api_secret</span><span class="p">)</span>
</code></pre></div>
<p><strong>Query Parameters</strong></p>

<p>None.</p>

<p><strong>Response</strong></p>

<p>If successful, returns a status code of 204 and an empty body.</p>
<h3 id='cancel-a-scheduled-payment-attempt-retry-using-transactionexternalkey'>Cancel a scheduled payment attempt retry [using transactionExternalKey]</h3>
<p>Cancels a scheduled attempt to retry a PaymentTransaction. The transaction is identified by its <code>transactionExternalKey</code>, which is provided as a query parameter.</p>

<p><strong>HTTP Request</strong> </p>

<p><code>DELETE http://127.0.0.1:8080/1.0/kb/payments/cancelScheduledPaymentTransaction</code></p>

<blockquote>
<p>Example Request:</p>
</blockquote>
<div class="highlight"><pre class="highlight shell tab-shell"><code>curl <span class="nt">-v</span> <span class="se">\</span>
    <span class="nt">-X</span> DELETE <span class="se">\</span>
    <span class="nt">-u</span> admin:password <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiKey: bob'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiSecret: lazar'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-CreatedBy: demo'</span> <span class="se">\</span>
    <span class="s1">'http://127.0.0.1:8080/1.0/kb/payments/cancelScheduledPaymentTransaction?transactionExternalKey=transaction'</span>    
</code></pre></div><div class="highlight"><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">org.killbill.billing.client.api.gen.PaymentApi</span><span class="o">;</span>
<span class="kd">protected</span> <span class="nc">PaymentApi</span> <span class="n">paymentApi</span><span class="o">;</span>

<span class="nc">String</span> <span class="n">transactionExternalKey</span> <span class="o">=</span> <span class="s">"example_payment_external_key"</span><span class="o">;</span>

<span class="n">paymentApi</span><span class="o">.</span><span class="na">cancelScheduledPaymentTransactionByExternalKey</span><span class="o">(</span><span class="n">transactionExternalKey</span><span class="o">,</span> <span class="n">inputOptions</span><span class="o">);</span>
</code></pre></div><div class="highlight"><pre class="highlight ruby tab-ruby"><code><span class="n">transaction</span>                          <span class="o">=</span> <span class="no">KillBillClient</span><span class="o">::</span><span class="no">Model</span><span class="o">::</span><span class="no">Transaction</span><span class="p">.</span><span class="nf">new</span>
<span class="n">transaction</span><span class="p">.</span><span class="nf">transaction_external_key</span> <span class="o">=</span> <span class="s2">"example_payment_external_key"</span>

<span class="n">transaction</span><span class="p">.</span><span class="nf">cancel_scheduled_payment</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> 
                                     <span class="n">reason</span><span class="p">,</span> 
                                     <span class="n">comment</span><span class="p">,</span> 
                                     <span class="n">options</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="n">paymentApi</span> <span class="o">=</span> <span class="n">killbill</span><span class="p">.</span><span class="n">api</span><span class="p">.</span><span class="n">PaymentApi</span><span class="p">()</span>
<span class="n">transaction_external_key</span> <span class="o">=</span> <span class="s">'example_payment_external_key'</span>

<span class="n">paymentApi</span><span class="p">.</span><span class="n">cancel_scheduled_payment_transaction_by_external_key</span><span class="p">(</span><span class="n">transaction_external_key</span><span class="p">,</span>
                                                                <span class="n">created_by</span><span class="p">,</span>
                                                                <span class="n">api_key</span><span class="p">,</span>
                                                                <span class="n">api_secret</span><span class="p">)</span>
</code></pre></div>
<p><strong>Query Parameters</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Required</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>transactionExternalKey</strong></td>
<td>string</td>
<td>yes</td>
<td>none</td>
<td>Transaction external key</td>
</tr>
</tbody></table>

<p><strong>Response</strong></p>

<p>If successful, returns a status code of 204 and an empty body.</p>
<h3 id='combo-api-to-create-a-new-payment-transaction-on-a-existing-or-not-account'>Combo api to create a new payment transaction on a existing (or not) account</h3>
<p>This API creates a PaymentTransaction of type AUTHORIZE, PURCHASE, or CREDIT. This is the same as the API <a href="account.html#account-trigger-a-payment-authorization-purchase-or-credit">Trigger a Payment</a> described with the Account endpoints. However, this API can optionally create a new Account and register a new PaymentMethod at the same time.</p>

<p><strong>HTTP Request</strong> </p>

<p><code>POST http://127.0.0.1:8080/1.0/kb/payments/combo</code></p>

<blockquote>
<p>Example Request:</p>
</blockquote>
<div class="highlight"><pre class="highlight shell tab-shell"><code>curl <span class="nt">-v</span> <span class="se">\</span>
    <span class="nt">-X</span> POST <span class="se">\</span>
    <span class="nt">-u</span> admin:password <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiKey: bob'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiSecret: lazar'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-CreatedBy: demo'</span> <span class="se">\</span>
    <span class="nt">-d</span> <span class="s1">'{
            "account": 
            {
                "name": "John Doe"
            },
            "paymentMethod": 
            {
                "pluginName": "__EXTERNAL_PAYMENT__"
            },
            "transaction":
            {
                "transactionType": "AUTHORIZE",
                "amount": 5,
                "currency": "USD"
            }
        }'</span> <span class="se">\</span>
    <span class="s1">'http://127.0.0.1:8080/1.0/kb/payments/combo'</span> 
</code></pre></div><div class="highlight"><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">org.killbill.billing.client.api.gen.AccountApi</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.killbill.billing.client.api.gen.PaymentApi</span><span class="o">;</span>
<span class="kd">protected</span> <span class="nc">PaymentApi</span> <span class="n">paymentApi</span><span class="o">;</span>

<span class="nc">Account</span> <span class="n">account</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Account</span><span class="o">();</span>
<span class="n">account</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"Jane Doe"</span><span class="o">);</span>
<span class="n">account</span><span class="o">.</span><span class="na">setExternalKey</span><span class="o">(</span><span class="s">"JaneDoe"</span><span class="o">);</span>

<span class="nc">PaymentMethod</span> <span class="n">paymentMethod</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PaymentMethod</span><span class="o">();</span>
<span class="n">paymentMethod</span><span class="o">.</span><span class="na">setPluginName</span><span class="o">(</span><span class="s">"__EXTERNAL_PAYMENT__"</span><span class="o">);</span>

<span class="nc">PaymentTransaction</span> <span class="n">paymentTransaction</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PaymentTransaction</span><span class="o">();</span>
<span class="n">paymentTransaction</span><span class="o">.</span><span class="na">setAmount</span><span class="o">(</span><span class="nc">BigDecimal</span><span class="o">.</span><span class="na">TEN</span><span class="o">);</span>
<span class="n">paymentTransaction</span><span class="o">.</span><span class="na">setCurrency</span><span class="o">(</span><span class="nc">Currency</span><span class="o">.</span><span class="na">USD</span><span class="o">);</span>
<span class="n">paymentTransaction</span><span class="o">.</span><span class="na">setTransactionType</span><span class="o">(</span><span class="nc">TransactionType</span><span class="o">.</span><span class="na">AUTHORIZE</span><span class="o">);</span>

<span class="nc">ComboPaymentTransaction</span> <span class="n">body</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ComboPaymentTransaction</span><span class="o">();</span>
<span class="n">body</span><span class="o">.</span><span class="na">setAccount</span><span class="o">(</span><span class="n">account</span><span class="o">);</span>
<span class="n">body</span><span class="o">.</span><span class="na">setPaymentMethod</span><span class="o">(</span><span class="n">paymentMethod</span><span class="o">);</span>
<span class="n">body</span><span class="o">.</span><span class="na">setTransaction</span><span class="o">(</span><span class="n">paymentTransaction</span><span class="o">);</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="no">NULL_PLUGIN_NAMES</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

<span class="nc">Payment</span> <span class="n">result</span> <span class="o">=</span> <span class="n">paymentApi</span><span class="o">.</span><span class="na">createComboPayment</span><span class="o">(</span><span class="n">body</span><span class="o">,</span>  <span class="no">NULL_PLUGIN_NAMES</span><span class="o">,</span> <span class="n">requestOptions</span><span class="o">);</span>
</code></pre></div><div class="highlight"><pre class="highlight ruby tab-ruby"><code><span class="n">combo_transaction</span> <span class="o">=</span> <span class="no">KillBillClient</span><span class="o">::</span><span class="no">Model</span><span class="o">::</span><span class="no">ComboTransaction</span><span class="p">.</span><span class="nf">new</span>
<span class="n">combo_transaction</span><span class="p">.</span><span class="nf">account</span> <span class="o">=</span> <span class="n">account_obj</span>
<span class="n">combo_transaction</span><span class="p">.</span><span class="nf">payment_method</span> <span class="o">=</span> <span class="n">payment_method_obj</span>
<span class="n">combo_transaction</span><span class="p">.</span><span class="nf">transaction</span> <span class="o">=</span> <span class="n">transaction_obj</span>

<span class="n">refresh_options</span> <span class="o">=</span> <span class="kp">nil</span>

<span class="c1"># Authorization</span>
<span class="n">combo_transaction</span><span class="p">.</span><span class="nf">auth</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> 
                       <span class="n">reason</span><span class="p">,</span> 
                       <span class="n">comment</span><span class="p">,</span> 
                       <span class="n">options</span><span class="p">,</span> 
                       <span class="n">refresh_options</span><span class="p">)</span>

<span class="c1"># Purchase</span>
<span class="n">combo_transaction</span><span class="p">.</span><span class="nf">purchase</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> 
                           <span class="n">reason</span><span class="p">,</span> 
                           <span class="n">comment</span><span class="p">,</span> 
                           <span class="n">options</span><span class="p">,</span> 
                           <span class="n">refresh_options</span><span class="p">)</span>

<span class="c1"># Credit</span>
<span class="n">combo_transaction</span><span class="p">.</span><span class="nf">credit</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> 
                         <span class="n">reason</span><span class="p">,</span> 
                         <span class="n">comment</span><span class="p">,</span> 
                         <span class="n">options</span><span class="p">,</span> 
                         <span class="n">refresh_options</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="n">paymentApi</span> <span class="o">=</span> <span class="n">killbill</span><span class="p">.</span><span class="n">api</span><span class="p">.</span><span class="n">PaymentApi</span><span class="p">()</span>
<span class="n">body</span> <span class="o">=</span> <span class="n">ComboPaymentTransaction</span><span class="p">(</span><span class="n">account_obj</span><span class="p">,</span> <span class="n">payment_method_obj</span><span class="p">,</span> <span class="n">payment_transaction_obj</span><span class="p">)</span>

<span class="n">paymentApi</span><span class="p">.</span><span class="n">create_combo_payment</span><span class="p">(</span><span class="n">body</span><span class="p">,</span>
                                <span class="n">created_by</span><span class="p">,</span>
                                <span class="n">api_key</span><span class="p">,</span>
                                <span class="n">api_secret</span><span class="p">)</span>
</code></pre></div>
<p><strong>Request Body</strong></p>

<p>The request body is a JSON string that represents three distinct objects: account, paymentMethod, and transaction. For example:</p>
<div class="highlight"><pre class="highlight plaintext"><code>{
  "account": {
  },
  "paymentMethod": {
    "pluginName": "__EXTERNAL_PAYMENT__"
  "transaction": {
    "transactionType": "AUTHORIZE",
    "amount": 500,
    "currency": "USD"
  }
}
</code></pre></div>
<p>This example assumes that a new Account is to be created.</p>

<ol>
<li><p>No attributes are required for the account; however if the <code>currency</code> attribute is not given here it must be given for the transaction.</p></li>
<li><p>If a new account is created, a new paymentMethod must be registered for that account.  The only attribute required here is the pluginName.</p></li>
<li><p>The transaction object contains, as a minimum, the transaction type, the amount, and the currency, unless given with the account.</p></li>
</ol>

<p><strong>Query Parameters</strong></p>

<p>None. </p>

<p><strong>Returns</strong></p>

<p>If successful, returns a status code of 201 and an empty body. In addition, a <code>Location</code> header containing the <code>paymentId</code> is returned.</p>
<h2 id='custom-fields'>Custom Fields</h2>
<p>Custom fields are <code>{key, value}</code> attributes that can be attached to any customer resource. In particular they can be added to Payment objects. For details on Custom Fields see <a href="custom-field.html#custom-field">Custom Field</a>.</p>
<h3 id='add-custom-fields-to-payment'>Add custom fields to payment</h3>
<p>Adds one or more custom fields to a payment object. Existing custom fields are not modified.</p>

<p><strong>HTTP Request</strong> </p>

<p><code>POST http://127.0.0.1:8080/1.0/kb/payments/{paymentId}/customFields</code></p>

<blockquote>
<p>Example Request:</p>
</blockquote>
<div class="highlight"><pre class="highlight shell tab-shell"><code>curl <span class="nt">-v</span> <span class="se">\</span>
    <span class="nt">-X</span> POST <span class="se">\</span>
    <span class="nt">-u</span> admin:password <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiKey: bob'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiSecret: lazar'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-CreatedBy: demo'</span> <span class="se">\</span>
    <span class="nt">-d</span> <span class="s1">'[{ 
            "name": "Test Custom Field",
            "value": "test_value"
    }]'</span> <span class="se">\</span>
    <span class="s1">'http://127.0.0.1:8080/1.0/kb/payments/8fe697d4-2c25-482c-aa45-f6cd5a48186d/customFields'</span> 
</code></pre></div><div class="highlight"><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">org.killbill.billing.client.api.gen.PaymentApi</span><span class="o">;</span>
<span class="kd">protected</span> <span class="nc">PaymentApi</span> <span class="n">paymentApi</span><span class="o">;</span>

<span class="no">UUID</span> <span class="n">paymentId</span> <span class="o">=</span> <span class="no">UUID</span><span class="o">.</span><span class="na">fromString</span><span class="o">(</span><span class="s">"cca08349-8b26-41c7-bfcc-2e3cf70a0f28"</span><span class="o">);</span>

<span class="kd">final</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">AuditLog</span><span class="o">&gt;</span> <span class="no">EMPTY_AUDIT_LOGS</span> <span class="o">=</span> <span class="nc">Collections</span><span class="o">.</span><span class="na">emptyList</span><span class="o">();</span>

<span class="nc">CustomFields</span> <span class="n">customFields</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CustomFields</span><span class="o">();</span>
<span class="n">customFields</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">CustomField</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> 
                                 <span class="n">paymentId</span><span class="o">,</span> 
                                 <span class="nc">ObjectType</span><span class="o">.</span><span class="na">PAYMENT</span><span class="o">,</span> 
                                 <span class="s">"Test Custom Field"</span><span class="o">,</span> 
                                 <span class="s">"test_value"</span><span class="o">,</span> 
                                 <span class="no">EMPTY_AUDIT_LOGS</span><span class="o">));</span>

<span class="n">paymentApi</span><span class="o">.</span><span class="na">createPaymentCustomFields</span><span class="o">(</span><span class="n">paymentId</span><span class="o">,</span> 
                                     <span class="n">customFields</span><span class="o">,</span> 
                                     <span class="n">requestOptions</span><span class="o">);</span>
</code></pre></div><div class="highlight"><pre class="highlight ruby tab-ruby"><code><span class="n">custom_field</span> <span class="o">=</span> <span class="no">KillBillClient</span><span class="o">::</span><span class="no">Model</span><span class="o">::</span><span class="no">CustomFieldAttributes</span><span class="p">.</span><span class="nf">new</span>
<span class="n">custom_field</span><span class="p">.</span><span class="nf">object_type</span> <span class="o">=</span> <span class="s1">'PAYMENT'</span>
<span class="n">custom_field</span><span class="p">.</span><span class="nf">name</span> <span class="o">=</span> <span class="s1">'Test Custom Field'</span>
<span class="n">custom_field</span><span class="p">.</span><span class="nf">value</span> <span class="o">=</span> <span class="s1">'test_value'</span>

<span class="n">payment</span><span class="p">.</span><span class="nf">add_custom_field</span><span class="p">(</span><span class="n">custom_field</span><span class="p">,</span> 
                         <span class="n">user</span><span class="p">,</span>
                         <span class="n">reason</span><span class="p">,</span>
                         <span class="n">comment</span><span class="p">,</span>
                         <span class="n">options</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="n">paymentApi</span> <span class="o">=</span> <span class="n">killbill</span><span class="p">.</span><span class="n">api</span><span class="p">.</span><span class="n">PaymentApi</span><span class="p">()</span>
<span class="n">body</span> <span class="o">=</span> <span class="n">CustomField</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'Test Custom Field'</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s">'test_value'</span><span class="p">)</span>

<span class="n">paymentApi</span><span class="p">.</span><span class="n">create_payment_custom_fields</span><span class="p">(</span><span class="n">payment_id</span><span class="p">,</span>
                                        <span class="p">[</span><span class="n">body</span><span class="p">],</span>
                                        <span class="n">created_by</span><span class="p">,</span>
                                        <span class="n">api_key</span><span class="p">,</span>
                                        <span class="n">api_secret</span><span class="p">)</span>
</code></pre></div>
<p><strong>Request Body</strong></p>

<p>A list of <a href="custom-field.html#custom-field-custom-field-resource">Custom Field</a> objects. Each object should specify at least the the <code>name</code> and <code>value</code> attribute. For example:</p>

<p>[ { &quot;name&quot;: &quot;CF1&quot;, &quot;value&quot;: &quot;123&quot; } ]</p>

<p><strong>Query Parameters</strong></p>

<p>None.</p>

<p><strong>Response</strong></p>

<p>If successful, returns a 201 status code. In addition, a Location header is returned with the URL to retrieve the custom fields associated with the payment.</p>
<h3 id='retrieve-payment-custom-fields'>Retrieve payment custom fields</h3>
<p>Retrieves the custom fields associated with a payment</p>

<p><strong>HTTP Request</strong> </p>

<p><code>GET http://127.0.0.1:8080/1.0/kb/payments/{paymentId}/customFields</code></p>

<blockquote>
<p>Example Request:</p>
</blockquote>
<div class="highlight"><pre class="highlight shell tab-shell"><code>curl <span class="se">\</span>
    <span class="nt">-u</span> admin:password <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiKey: bob'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiSecret: lazar'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'Accept: application/json'</span> <span class="se">\</span>
    <span class="s1">'http://127.0.0.1:8080/1.0/kb/payments/8fe697d4-2c25-482c-aa45-f6cd5a48186d/customFields'</span> 
</code></pre></div><div class="highlight"><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">org.killbill.billing.client.api.gen.PaymentApi</span><span class="o">;</span>
<span class="kd">protected</span> <span class="nc">PaymentApi</span> <span class="n">paymentApi</span><span class="o">;</span>

<span class="no">UUID</span> <span class="n">paymentId</span> <span class="o">=</span> <span class="no">UUID</span><span class="o">.</span><span class="na">fromString</span><span class="o">(</span><span class="s">"cca08349-8b26-41c7-bfcc-2e3cf70a0f28"</span><span class="o">);</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">CustomField</span><span class="o">&gt;</span> <span class="n">customFields</span> <span class="o">=</span> <span class="n">paymentApi</span><span class="o">.</span><span class="na">getPaymentCustomFields</span><span class="o">(</span><span class="n">paymentId</span><span class="o">,</span>
                                                                   <span class="nc">AuditLevel</span><span class="o">.</span><span class="na">NONE</span><span class="o">,</span>
                                                                   <span class="n">requestOptions</span><span class="o">);</span>
</code></pre></div><div class="highlight"><pre class="highlight ruby tab-ruby"><code><span class="n">audit</span> <span class="o">=</span> <span class="s1">'NONE'</span>

<span class="n">payment</span><span class="p">.</span><span class="nf">custom_fields</span><span class="p">(</span><span class="n">audit</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="n">paymentApi</span> <span class="o">=</span> <span class="n">killbill</span><span class="p">.</span><span class="n">api</span><span class="p">.</span><span class="n">PaymentApi</span><span class="p">()</span>

<span class="n">paymentApi</span><span class="p">.</span><span class="n">get_payment_custom_fields</span><span class="p">(</span><span class="n">payment_id</span><span class="p">,</span> <span class="n">api_key</span><span class="p">,</span> <span class="n">api_secret</span><span class="p">)</span>
</code></pre></div>
<blockquote>
<p>Example Response:</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"customFieldId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"e4bac228-872d-4966-8072-2c3ac06442ed"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"objectId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"8fe697d4-2c25-482c-aa45-f6cd5a48186d"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"objectType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PAYMENT"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Test Custom Field"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"test_value"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"auditLogs"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div>
<p><strong>Query Parameters</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Required</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>audit</strong></td>
<td>string</td>
<td>no</td>
<td>&quot;NONE&quot;</td>
<td>Level of audit information to return:&quot;NONE&quot;, &quot;MINIMAL&quot;, or &quot;FULL&quot;</td>
</tr>
</tbody></table>

<p><strong>Response</strong></p>

<p>If successful, returns a status code of 200 and a (possibly empty) list of custom field objects.</p>
<h3 id='modify-custom-fields-for-a-payment'>Modify custom fields for a payment</h3>
<p>Modifies the custom fields associated with a payment object</p>

<p><strong>HTTP Request</strong> </p>

<p><code>PUT http://127.0.0.1:8080/1.0/kb/payments/{paymentId}/customFields</code></p>

<blockquote>
<p>Example Request:</p>
</blockquote>
<div class="highlight"><pre class="highlight shell tab-shell"><code>curl <span class="nt">-v</span> <span class="se">\</span>
    <span class="nt">-X</span> PUT <span class="se">\</span>
    <span class="nt">-u</span> admin:password <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiKey: bob'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiSecret: lazar'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-CreatedBy: demo'</span> <span class="se">\</span>
    <span class="nt">-d</span> <span class="s1">'[{ 
            "customFieldId": "e4bac228-872d-4966-8072-2c3ac06442ed",
            "value": "NewValue"
    }]'</span> <span class="se">\</span>
    <span class="s1">'http://127.0.0.1:8080/1.0/kb/payments/8fe697d4-2c25-482c-aa45-f6cd5a48186d/customFields'</span> 
</code></pre></div><div class="highlight"><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">org.killbill.billing.client.api.gen.PaymentApi</span><span class="o">;</span>
<span class="kd">protected</span> <span class="nc">PaymentApi</span> <span class="n">paymentApi</span><span class="o">;</span>

<span class="no">UUID</span> <span class="n">paymentId</span> <span class="o">=</span> <span class="no">UUID</span><span class="o">.</span><span class="na">fromString</span><span class="o">(</span><span class="s">"cca08349-8b26-41c7-bfcc-2e3cf70a0f28"</span><span class="o">);</span>
<span class="no">UUID</span> <span class="n">customFieldsId</span> <span class="o">=</span> <span class="no">UUID</span><span class="o">.</span><span class="na">fromString</span><span class="o">(</span><span class="s">"9913e0f6-b5ef-498b-ac47-60e1626eba8f"</span><span class="o">);</span>

<span class="nc">CustomField</span> <span class="n">customFieldModified</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CustomField</span><span class="o">();</span>
<span class="n">customFieldModified</span><span class="o">.</span><span class="na">setCustomFieldId</span><span class="o">(</span><span class="n">customFieldsId</span><span class="o">);</span>
<span class="n">customFieldModified</span><span class="o">.</span><span class="na">setValue</span><span class="o">(</span><span class="s">"NewValue"</span><span class="o">);</span>

<span class="n">paymentApi</span><span class="o">.</span><span class="na">modifyPaymentCustomFields</span><span class="o">(</span><span class="n">paymentId</span><span class="o">,</span> 
                                     <span class="n">customFieldModified</span><span class="o">,</span> 
                                     <span class="n">requestOptions</span><span class="o">);</span>
</code></pre></div><div class="highlight"><pre class="highlight ruby tab-ruby"><code><span class="n">custom_field</span><span class="p">.</span><span class="nf">custom_field_id</span> <span class="o">=</span> <span class="s1">'7fb3dde7-0911-4477-99e3-69d142509bb9'</span>
<span class="n">custom_field</span><span class="p">.</span><span class="nf">name</span> <span class="o">=</span> <span class="s1">'Test Modify'</span>
<span class="n">custom_field</span><span class="p">.</span><span class="nf">value</span> <span class="o">=</span> <span class="s1">'test_modify_value'</span>

<span class="n">payment</span><span class="p">.</span><span class="nf">modify_custom_field</span><span class="p">(</span><span class="n">custom_field</span><span class="p">,</span>                                                                                            
                            <span class="n">user</span><span class="p">,</span> 
                            <span class="n">reason</span><span class="p">,</span>
                            <span class="n">comment</span><span class="p">,</span> 
                            <span class="n">options</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="n">paymentApi</span> <span class="o">=</span> <span class="n">killbill</span><span class="p">.</span><span class="n">api</span><span class="p">.</span><span class="n">PaymentApi</span><span class="p">()</span>
<span class="n">payment_id</span> <span class="o">=</span> <span class="s">'f33e0adc-78df-438a-b920-aaacd7f8597a'</span>
<span class="n">custom_field_id</span> <span class="o">=</span> <span class="s">'9913e0f6-b5ef-498b-ac47-60e1626eba8f'</span>
<span class="n">body</span> <span class="o">=</span> <span class="n">CustomField</span><span class="p">(</span><span class="n">custom_field_id</span><span class="o">=</span><span class="n">custom_field_id</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'Test Modify'</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s">'test_modify_value'</span><span class="p">)</span>

<span class="n">paymentApi</span><span class="p">.</span><span class="n">modify_payment_custom_fields</span><span class="p">(</span><span class="n">payment_id</span><span class="p">,</span>
                                        <span class="p">[</span><span class="n">body</span><span class="p">],</span>
                                        <span class="n">created_by</span><span class="p">,</span>
                                        <span class="n">api_key</span><span class="p">,</span>
                                        <span class="n">api_secret</span><span class="p">)</span>
</code></pre></div>
<p><strong>Requst Body</strong></p>

<p>A list of <a href="custom-field.html#custom-field-custom-field-resource">Custom Field</a> objects representing the fields to substitute for existing ones. Each object should specify at least the the <code>customFieldId</code> and <code>value</code> attribute. For example:</p>

<p>[ { &quot;customFieldId&quot;: &quot;6d4c073b-fd89-4e39-9802-eba65f42492f&quot;, &quot;value&quot;: &quot;123&quot; } ]</p>

<p><strong>Query Parameters</strong></p>

<p>None.</p>

<p><strong>Response</strong></p>

<p>If successful, returns a status code of 204 and an empty body.</p>
<h3 id='remove-custom-fields-from-a-payment'>Remove custom fields from a payment</h3>
<p>Removes a specified set of custom fields from a payment object</p>

<p><strong>HTTP Request</strong> </p>

<p><code>DELETE http://127.0.0.1:8080/1.0/kb/payments/{paymentId}/customFields</code></p>

<blockquote>
<p>Example Request:</p>
</blockquote>
<div class="highlight"><pre class="highlight shell tab-shell"><code>curl <span class="nt">-v</span> <span class="se">\</span>
    <span class="nt">-X</span> DELETE <span class="se">\</span>
    <span class="nt">-u</span> admin:password <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiKey: bob'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiSecret: lazar'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-CreatedBy: demo'</span> <span class="se">\</span>
    <span class="s1">'http://127.0.0.1:8080/1.0/kb/payments/77e23878-8b9d-403b-bf31-93003e125712/customFields?customField=e4bac228-872d-4966-8072-2c3ac06442ed'</span> 
</code></pre></div><div class="highlight"><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">org.killbill.billing.client.api.gen.PaymentApi</span><span class="o">;</span>
<span class="kd">protected</span> <span class="nc">PaymentApi</span> <span class="n">paymentApi</span><span class="o">;</span>

<span class="no">UUID</span> <span class="n">paymentId</span> <span class="o">=</span> <span class="no">UUID</span><span class="o">.</span><span class="na">fromString</span><span class="o">(</span><span class="s">"cca08349-8b26-41c7-bfcc-2e3cf70a0f28"</span><span class="o">);</span>
<span class="no">UUID</span> <span class="n">customFieldsId</span> <span class="o">=</span> <span class="no">UUID</span><span class="o">.</span><span class="na">fromString</span><span class="o">(</span><span class="s">"9913e0f6-b5ef-498b-ac47-60e1626eba8f"</span><span class="o">);</span>

<span class="n">paymentApi</span><span class="o">.</span><span class="na">deletePaymentCustomFields</span><span class="o">(</span><span class="n">paymentId</span><span class="o">,</span> 
                                     <span class="n">customFieldsId</span><span class="o">,</span> 
                                     <span class="n">requestOptions</span><span class="o">);</span>
</code></pre></div><div class="highlight"><pre class="highlight ruby tab-ruby"><code><span class="n">custom_field_id</span> <span class="o">=</span> <span class="n">custom_field</span><span class="p">.</span><span class="nf">id</span>

<span class="n">payment</span><span class="p">.</span><span class="nf">remove_custom_field</span><span class="p">(</span><span class="n">custom_field_id</span><span class="p">,</span>                                                                                            
                            <span class="n">user</span><span class="p">,</span> 
                            <span class="n">reason</span><span class="p">,</span>
                            <span class="n">comment</span><span class="p">,</span> 
                            <span class="n">options</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="n">paymentApi</span> <span class="o">=</span> <span class="n">killbill</span><span class="p">.</span><span class="n">api</span><span class="p">.</span><span class="n">PaymentApi</span><span class="p">()</span>
<span class="n">payment_id</span> <span class="o">=</span> <span class="s">'f33e0adc-78df-438a-b920-aaacd7f8597a'</span>

<span class="n">paymentApi</span><span class="p">.</span><span class="n">delete_payment_custom_fields</span><span class="p">(</span><span class="n">payment_id</span><span class="p">,</span>
                                        <span class="n">created_by</span><span class="p">,</span>
                                        <span class="n">api_key</span><span class="p">,</span>
                                        <span class="n">api_secret</span><span class="p">)</span>
</code></pre></div>
<p><strong>Query Parameters</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Required</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>customField</strong></td>
<td>string</td>
<td>yes</td>
<td>none</td>
<td>CCustom field object ID that should be deleted. Multiple custom fields can be deleted by specifying a separate <strong>customField</strong> parameter corresponding to each field</td>
</tr>
</tbody></table>

<p><strong>Response</strong></p>

<p>If successful, returns a status code of 204 and an empty body.</p>
<h2 id='tags'>Tags</h2>
<p>See <a href="account.html#account-tags">Account Tags</a> for an introduction.</p>

<p>The are no <code>system</code> tags applicable to a Payment.</p>
<h3 id='add-tags-to-a-payment'>Add tags to a payment</h3>
<p>Adds one or more tags to a payment object. The tag definitions must already exist.</p>

<p><strong>HTTP Request</strong> </p>

<p><code>POST http://127.0.0.1:8080/1.0/kb/payments/{paymentId}/tags</code></p>

<blockquote>
<p>Example Request:</p>
</blockquote>
<div class="highlight"><pre class="highlight shell tab-shell"><code>curl <span class="nt">-v</span> <span class="se">\</span>
    <span class="nt">-X</span> POST <span class="se">\</span>
    <span class="nt">-u</span> admin:password <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiKey: bob'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiSecret: lazar'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-CreatedBy: demo'</span> <span class="se">\</span>
    <span class="nt">-d</span> <span class="s1">'[
            "353752dd-9041-4450-b782-a8bb03a923c8"
        ]'</span> <span class="se">\</span>
    <span class="s1">'http://127.0.0.1:8080/1.0/kb/payments/8fe697d4-2c25-482c-aa45-f6cd5a48186d/tags'</span> 
</code></pre></div><div class="highlight"><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">org.killbill.billing.client.api.gen.PaymentApi</span><span class="o">;</span>
<span class="kd">protected</span> <span class="nc">PaymentApi</span> <span class="n">paymentApi</span><span class="o">;</span>

<span class="no">UUID</span> <span class="n">paymentId</span> <span class="o">=</span> <span class="no">UUID</span><span class="o">.</span><span class="na">fromString</span><span class="o">(</span><span class="s">"917992d3-5f1f-4828-9fff-799cc4211aa9"</span><span class="o">);</span>

<span class="no">UUID</span> <span class="n">tagDefinitionId</span> <span class="o">=</span> <span class="no">UUID</span><span class="o">.</span><span class="na">fromString</span><span class="o">(</span><span class="s">"353752dd-9041-4450-b782-a8bb03a923c8"</span><span class="o">);</span>

<span class="nc">Tags</span> <span class="n">result</span> <span class="o">=</span> <span class="n">paymentApi</span><span class="o">.</span><span class="na">createPaymentTags</span><span class="o">(</span><span class="n">paymentId</span><span class="o">,</span> 
                                           <span class="nc">List</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">tagDefinitionId</span><span class="o">),</span> 
                                           <span class="n">requestOptions</span><span class="o">);</span>
</code></pre></div><div class="highlight"><pre class="highlight ruby tab-ruby"><code><span class="n">tag_name</span> <span class="o">=</span> <span class="s1">'foo'</span>

<span class="n">payment</span><span class="p">.</span><span class="nf">add_tag</span><span class="p">(</span><span class="n">tag_name</span><span class="p">,</span>
                <span class="n">user</span><span class="p">,</span>
                <span class="n">reason</span><span class="p">,</span>
                <span class="n">comment</span><span class="p">,</span>
                <span class="n">options</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="n">paymentApi</span> <span class="o">=</span> <span class="n">killbill</span><span class="p">.</span><span class="n">api</span><span class="p">.</span><span class="n">PaymentApi</span><span class="p">()</span>
<span class="n">tag</span> <span class="o">=</span> <span class="p">[</span><span class="s">"353752dd-9041-4450-b782-a8bb03a923c8"</span><span class="p">]</span>

<span class="n">paymentApi</span><span class="p">.</span><span class="n">create_payment_tags</span><span class="p">(</span><span class="n">payment_id</span><span class="p">,</span>
                               <span class="n">tag</span><span class="p">,</span>
                               <span class="n">created_by</span><span class="p">,</span>
                               <span class="n">api_key</span><span class="p">,</span>
                               <span class="n">api_secret</span><span class="p">)</span>
</code></pre></div>
<p><strong>Request Body</strong></p>

<p>A JSON array containing one or more tag definition ids to be added as tags.</p>

<p><strong>Query Parameters</strong></p>

<p>None.</p>

<p><strong>Response</strong></p>

<p>If successful, returns a 201 status code. In addition, a Location header is returned containing the URL to retrieve the tags associated with the payment.</p>
<h3 id='retrieve-payment-tags'>Retrieve payment tags</h3>
<p>Retrieves all tags attached to this payment.</p>

<p><strong>HTTP Request</strong> </p>

<p><code>GET http://127.0.0.1:8080/1.0/kb/payments/{paymentId}/tags</code></p>

<blockquote>
<p>Example Request:</p>
</blockquote>
<div class="highlight"><pre class="highlight shell tab-shell"><code>curl <span class="se">\</span>
    <span class="nt">-u</span> admin:password <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiKey: bob'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiSecret: lazar'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'Accept: application/json'</span> <span class="se">\</span>
    <span class="s1">'http://127.0.0.1:8080/1.0/kb/payments/8fe697d4-2c25-482c-aa45-f6cd5a48186d/tags'</span> 
</code></pre></div><div class="highlight"><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">org.killbill.billing.client.api.gen.PaymentApi</span><span class="o">;</span>
<span class="kd">protected</span> <span class="nc">PaymentApi</span> <span class="n">paymentApi</span><span class="o">;</span>

<span class="no">UUID</span> <span class="n">paymentId</span> <span class="o">=</span> <span class="no">UUID</span><span class="o">.</span><span class="na">fromString</span><span class="o">(</span><span class="s">"e659f0f3-745c-46d5-953c-28fe9282fc7d"</span><span class="o">);</span>

<span class="nc">Boolean</span> <span class="n">includedDeleted</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span> <span class="c1">// Will not include deleted tags</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Tag</span><span class="o">&gt;</span> <span class="n">tags</span> <span class="o">=</span> <span class="n">paymentApi</span><span class="o">.</span><span class="na">getPaymentTags</span><span class="o">(</span><span class="n">paymentId</span><span class="o">,</span> 
                                           <span class="n">includedDeleted</span><span class="o">,</span> 
                                           <span class="nc">AuditLevel</span><span class="o">.</span><span class="na">FULL</span><span class="o">,</span> 
                                           <span class="n">requestOptions</span><span class="o">);</span>
</code></pre></div><div class="highlight"><pre class="highlight ruby tab-ruby"><code><span class="n">included_deleted</span> <span class="o">=</span> <span class="kp">false</span>
<span class="n">audit</span> <span class="o">=</span> <span class="s1">'NONE'</span>

<span class="n">payment</span><span class="p">.</span><span class="nf">tags</span><span class="p">(</span><span class="n">included_deleted</span><span class="p">,</span>
             <span class="n">audit</span><span class="p">,</span>
             <span class="n">options</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="n">paymentApi</span> <span class="o">=</span> <span class="n">killbill</span><span class="p">.</span><span class="n">api</span><span class="p">.</span><span class="n">PaymentApi</span><span class="p">()</span>
<span class="n">payment_id</span> <span class="o">=</span> <span class="s">'28af3cb9-275b-4ac4-a55d-a0536e479069'</span>

<span class="n">paymentApi</span><span class="p">.</span><span class="n">get_payment_tags</span><span class="p">(</span><span class="n">payment_id</span><span class="p">,</span> <span class="n">api_key</span><span class="p">,</span> <span class="n">api_secret</span><span class="p">)</span>
</code></pre></div>
<blockquote>
<p>Example Response:</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"tagId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"890e3b13-3114-478b-9365-50f1a2682143"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"objectType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PAYMENT"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"objectId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"8fe697d4-2c25-482c-aa45-f6cd5a48186d"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"tagDefinitionId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"353752dd-9041-4450-b782-a8bb03a923c8"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"tagDefinitionName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"foo"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"auditLogs"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div>
<p><strong>Query Parameters</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Required</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>includedDeleted</strong></td>
<td>boolean</td>
<td>no</td>
<td>false</td>
<td>If true, include deleted tags</td>
</tr>
<tr>
<td><strong>audit</strong></td>
<td>string</td>
<td>no</td>
<td>&quot;NONE&quot;</td>
<td>Level of audit information to return: &quot;NONE&quot;, &quot;MINIMAL&quot;, or &quot;FULL&quot;</td>
</tr>
</tbody></table>

<p><strong>Response</strong></p>

<p>If successful, returns a status code of 200 and a list of tag objects.</p>
<h3 id='remove-tags-from-a-payment'>Remove tags from a payment</h3>
<p>Removes a list of tags attached to a payment.</p>

<p><strong>HTTP Request</strong> </p>

<p><code>DELETE http://127.0.0.1:8080/1.0/kb/payments/{paymentId}/tags</code></p>

<blockquote>
<p>Example Request:</p>
</blockquote>
<div class="highlight"><pre class="highlight shell tab-shell"><code>curl <span class="nt">-v</span> <span class="se">\</span>
    <span class="nt">-X</span> DELETE <span class="se">\</span>
    <span class="nt">-u</span> admin:password <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiKey: bob'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiSecret: lazar'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-CreatedBy: demo'</span> <span class="se">\</span>
    <span class="s1">'http://127.0.0.1:8080/1.0/kb/payments/8fe697d4-2c25-482c-aa45-f6cd5a48186d/tags?tagDef=353752dd-9041-4450-b782-a8bb03a923c8'</span>   
</code></pre></div><div class="highlight"><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">org.killbill.billing.client.api.gen.PaymentApi</span><span class="o">;</span>
<span class="kd">protected</span> <span class="nc">PaymentApi</span> <span class="n">paymentApi</span><span class="o">;</span>

<span class="no">UUID</span> <span class="n">paymentId</span> <span class="o">=</span> <span class="no">UUID</span><span class="o">.</span><span class="na">fromString</span><span class="o">(</span><span class="s">"e659f0f3-745c-46d5-953c-28fe9282fc7d"</span><span class="o">);</span>

<span class="no">UUID</span> <span class="n">tagDefinitionId</span> <span class="o">=</span> <span class="no">UUID</span><span class="o">.</span><span class="na">fromString</span><span class="o">(</span><span class="s">"353752dd-9041-4450-b782-a8bb03a923c8"</span><span class="o">);</span>

<span class="n">paymentApi</span><span class="o">.</span><span class="na">deletePaymentTags</span><span class="o">(</span><span class="n">paymentId</span><span class="o">,</span> 
                             <span class="nc">List</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">tagDefinitionId</span><span class="o">),</span> 
                             <span class="n">requestOptions</span><span class="o">);</span>
</code></pre></div><div class="highlight"><pre class="highlight ruby tab-ruby"><code><span class="n">tag_name</span> <span class="o">=</span> <span class="s1">'TEST'</span>

<span class="n">payment</span><span class="p">.</span><span class="nf">remove_tag</span><span class="p">(</span><span class="n">tag_name</span><span class="p">,</span>
                   <span class="n">user</span><span class="p">,</span>
                   <span class="n">reason</span><span class="p">,</span>
                   <span class="n">comment</span><span class="p">,</span>
                   <span class="n">options</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="n">paymentApi</span> <span class="o">=</span> <span class="n">killbill</span><span class="p">.</span><span class="n">api</span><span class="p">.</span><span class="n">PaymentApi</span><span class="p">()</span>
<span class="n">payment_id</span> <span class="o">=</span> <span class="s">'dce5b2a0-0f0f-430b-9427-545ba4be5c7f'</span>
<span class="n">tag</span> <span class="o">=</span> <span class="p">[</span><span class="s">"353752dd-9041-4450-b782-a8bb03a923c8"</span><span class="p">]</span> 

<span class="n">paymentApi</span><span class="p">.</span><span class="n">delete_payment_tags</span><span class="p">(</span><span class="n">payment_id</span><span class="p">,</span>
                               <span class="n">created_by</span><span class="p">,</span>
                               <span class="n">api_key</span><span class="p">,</span>
                               <span class="n">api_secret</span><span class="p">,</span>
                               <span class="n">tag_def</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
</code></pre></div>
<p><strong>Query Parameters</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Required</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>tagDef</strong></td>
<td>array of string</td>
<td>yes</td>
<td>none</td>
<td>A tag definition ID identifying the tag that should be removed. Multiple tags can be deleted by specifying a separate tagDef parameter corresponding to each tag.</td>
</tr>
</tbody></table>

<p><strong>Response</strong></p>

<p>If successful, returns a status code of 204 and an empty body.</p>
<h2 id='audit-logs'>Audit Logs</h2>
<p>Audit logs provide a record of events that occur involving various specific resources. For details on audit logs see <a href="https://killbill.github.io/slate/#using-kill-bill-apis-audit-and-history">Audit and History</a>.</p>
<h3 id='retrieve-payment-audit-logs-with-history-by-id'>Retrieve payment audit logs with history by id</h3>
<p>Retrieves a list of audit log records showing events that occurred involving changes to a specified payment. History information is included with each record.</p>

<p><strong>HTTP Request</strong> </p>

<p><code>GET http://127.0.0.1:8080/1.0/kb/payments/{paymentId}/auditLogsWithHistory</code></p>

<blockquote>
<p>Example Request:</p>
</blockquote>
<div class="highlight"><pre class="highlight shell tab-shell"><code>curl <span class="se">\</span>
    <span class="nt">-u</span> admin:password <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiKey: bob'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiSecret: lazar'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'Accept: application/json'</span> <span class="se">\</span>
    <span class="s1">'http://127.0.0.1:8080/1.0/kb/payments/8fe697d4-2c25-482c-aa45-f6cd5a48186d/auditLogsWithHistory'</span> 
</code></pre></div><div class="highlight"><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">org.killbill.billing.client.api.gen.PaymentApi</span><span class="o">;</span>
<span class="kd">protected</span> <span class="nc">PaymentApi</span> <span class="n">paymentApi</span><span class="o">;</span>

<span class="no">UUID</span> <span class="n">paymentId</span> <span class="o">=</span> <span class="no">UUID</span><span class="o">.</span><span class="na">fromString</span><span class="o">(</span><span class="s">"cca08349-8b26-41c7-bfcc-2e3cf70a0f28"</span><span class="o">);</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">AuditLog</span><span class="o">&gt;</span> <span class="n">paymentAuditLogWithHistory</span> <span class="o">=</span> <span class="n">paymentApi</span><span class="o">.</span><span class="na">getPaymentAuditLogsWithHistory</span><span class="o">(</span><span class="n">paymentId</span><span class="o">,</span> 
                                                                                      <span class="n">requestOptions</span><span class="o">);</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="n">accountApi</span> <span class="o">=</span> <span class="n">killbill</span><span class="p">.</span><span class="n">api</span><span class="p">.</span><span class="n">AccountApi</span><span class="p">()</span>
<span class="n">account_id</span> <span class="o">=</span> <span class="s">'c62d5f6d-0b57-444d-bf9b-dd23e781fbda'</span>

<span class="n">accountApi</span><span class="p">.</span><span class="n">get_account_audit_logs_with_history</span><span class="p">(</span><span class="n">account_id</span><span class="p">,</span> <span class="n">api_key</span><span class="p">,</span> <span class="n">api_secret</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="highlight ruby tab-ruby"><code><span class="n">account</span><span class="p">.</span><span class="nf">audit_logs_with_history</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
</code></pre></div>
<blockquote>
<p>Example Response:</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"changeType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"INSERT"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"changeDate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-07-19T16:39:00.000Z"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"objectType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PAYMENT"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"objectId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"8fe697d4-2c25-482c-aa45-f6cd5a48186d"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"changedBy"</span><span class="p">:</span><span class="w"> </span><span class="s2">"demo"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"reasonCode"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nl">"comments"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nl">"userToken"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5d32d0ab-3c08-47b2-8c6d-bb9d2a7fd62c"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"history"</span><span class="p">:</span><span class="w"> 
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nl">"createdDate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-07-19T16:39:00.000Z"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"updatedDate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-07-19T16:39:00.000Z"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"recordId"</span><span class="p">:</span><span class="w"> </span><span class="mi">14</span><span class="p">,</span><span class="w">
      </span><span class="nl">"accountRecordId"</span><span class="p">:</span><span class="w"> </span><span class="mi">35</span><span class="p">,</span><span class="w">
      </span><span class="nl">"tenantRecordId"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
      </span><span class="nl">"accountId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"84c7e0d4-a5ed-405f-a655-3ed16ae19997"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"paymentNumber"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nl">"paymentMethodId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"916619a4-02bb-4d3d-b3da-2584ac897b19"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"externalKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"paymentExternalKey"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"stateName"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nl">"lastSuccessStateName"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nl">"tableName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PAYMENTS"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"historyTableName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PAYMENT_HISTORY"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div>
<p><strong>Query Parameters</strong></p>

<p>None.</p>

<p><strong>Response</strong></p>

<p>If successful, returns a status code of 200 and a list of payment audit logs with history.</p>
<h3 id='retrieve-payment-attempt-audit-logs-with-history-by-id'>Retrieve payment attempt audit logs with history by id</h3>
<p>Retrieves a list of audit log records showing events that occurred related to a specified payment attempt. History information is included with each record.</p>

<p><strong>HTTP Request</strong></p>

<p><code>GET http://127.0.0.1:8080/1.0/kb/payments/attempts/{payment_attempt_id}/auditLogsWithHistory</code></p>

<blockquote>
<p>Example Request:</p>
</blockquote>
<div class="highlight"><pre class="highlight shell tab-shell"><code>curl <span class="se">\</span>
    <span class="nt">-u</span> admin:password <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiKey: bob'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiSecret: lazar'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'Accept: application/json'</span> <span class="se">\</span>
     <span class="s1">'http://127.0.0.1:8080/1.0/kb/payments/attempts/&lt;payment_attempt_id&gt;/auditLogsWithHistory'</span>  
</code></pre></div><div class="highlight"><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">org.killbill.billing.client.api.gen.PaymentApi</span><span class="o">;</span>
<span class="kd">protected</span> <span class="nc">PaymentApi</span> <span class="n">paymentApi</span><span class="o">;</span>

<span class="no">UUID</span> <span class="n">paymentAttemptId</span> <span class="o">=</span> <span class="no">UUID</span><span class="o">.</span><span class="na">fromString</span><span class="o">(</span><span class="s">"2706b8c6-97f2-41b7-b9c5-de23726bb399"</span><span class="o">);</span>
<span class="nc">AuditLogs</span> <span class="n">logs</span> <span class="o">=</span> <span class="n">paymentApi</span><span class="o">.</span><span class="na">getPaymentAttemptAuditLogsWithHistory</span><span class="o">(</span><span class="n">paymentAttemptId</span><span class="o">,</span> <span class="n">requestOptions</span><span class="o">);</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code></code></pre></div><div class="highlight"><pre class="highlight ruby tab-ruby"><code></code></pre></div>
<blockquote>
<p>Example Response:</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">  
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"changeType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"INSERT"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"changeDate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2022-05-02T11:15:52.000Z"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"objectType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PAYMENT_ATTEMPT"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"objectId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2706b8c6-97f2-41b7-b9c5-de23726bb399"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"changedBy"</span><span class="p">:</span><span class="w"> </span><span class="s2">"admin"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"reasonCode"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nl">"comments"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nl">"userToken"</span><span class="p">:</span><span class="w"> </span><span class="s2">"b65afb87-9e43-4ffe-a492-84ac5d5f10a9"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"history"</span><span class="p">:</span><span class="w"> 
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nl">"createdDate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2022-05-02T11:15:52.000Z"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"updatedDate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2022-05-02T11:15:52.000Z"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"recordId"</span><span class="p">:</span><span class="w"> </span><span class="mi">11214</span><span class="p">,</span><span class="w">
      </span><span class="nl">"accountRecordId"</span><span class="p">:</span><span class="w"> </span><span class="mi">2306</span><span class="p">,</span><span class="w">
      </span><span class="nl">"tenantRecordId"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
      </span><span class="nl">"accountId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bdcd8ed0-ffc6-42db-88eb-cf1ee504b9a8"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"paymentMethodId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"82e375db-4aff-413e-9b52-f70803ea3bc5"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"paymentExternalKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1833cad4-4b10-432e-959b-01dbf3ca0596"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"transactionId"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nl">"transactionExternalKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"92f17f72-c03f-427b-95eb-a959451c37b8"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"transactionType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PURCHASE"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"stateName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"INIT"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
      </span><span class="nl">"currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"USD"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"pluginName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"__INVOICE_PAYMENT_CONTROL_PLUGIN__"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"pluginProperties"</span><span class="p">:</span><span class="w"> </span><span class="s2">"WlYAAAJbXQ=="</span><span class="p">,</span><span class="w">
      </span><span class="nl">"historyTableName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PAYMENT_ATTEMPT_HISTORY"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"tableName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PAYMENT_ATTEMPTS"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"changeType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UPDATE"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"changeDate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2022-05-02T11:15:52.000Z"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"objectType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PAYMENT_ATTEMPT"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"objectId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2706b8c6-97f2-41b7-b9c5-de23726bb399"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"changedBy"</span><span class="p">:</span><span class="w"> </span><span class="s2">"admin"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"reasonCode"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nl">"comments"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nl">"userToken"</span><span class="p">:</span><span class="w"> </span><span class="s2">"b65afb87-9e43-4ffe-a492-84ac5d5f10a9"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"history"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nl">"createdDate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2022-05-02T11:15:52.000Z"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"updatedDate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2022-05-02T11:15:52.000Z"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"recordId"</span><span class="p">:</span><span class="w"> </span><span class="mi">11214</span><span class="p">,</span><span class="w">
      </span><span class="nl">"accountRecordId"</span><span class="p">:</span><span class="w"> </span><span class="mi">2306</span><span class="p">,</span><span class="w">
      </span><span class="nl">"tenantRecordId"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
      </span><span class="nl">"accountId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bdcd8ed0-ffc6-42db-88eb-cf1ee504b9a8"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"paymentMethodId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"82e375db-4aff-413e-9b52-f70803ea3bc5"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"paymentExternalKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1833cad4-4b10-432e-959b-01dbf3ca0596"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"transactionId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"92f17f72-c03f-427b-95eb-a959451c37b8"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"transactionExternalKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"92f17f72-c03f-427b-95eb-a959451c37b8"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"transactionType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PURCHASE"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"stateName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SUCCESS"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
      </span><span class="nl">"currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"USD"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"pluginName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"__INVOICE_PAYMENT_CONTROL_PLUGIN__"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"pluginProperties"</span><span class="p">:</span><span class="w"> </span><span class="s2">"WlYAADxbeyJJUENEX0lOVk9JQ0VfSUQiOiI3MzdmNDRhMi1iYTljLTRjNjQtOTQzYi04NWRlMjEyODMxYWMifV0="</span><span class="p">,</span><span class="w">
      </span><span class="nl">"historyTableName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PAYMENT_ATTEMPT_HISTORY"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"tableName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PAYMENT_ATTEMPTS"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div>
<p><strong>Query Parameters</strong></p>

<p>None.</p>

<p><strong>Response</strong></p>

<p>If successful, returns a status code of 200 and a list of payment attempt audit logs with history.</p>
<h2 id='list-and-search'>List and Search</h2>
<p>These endpoints allow you to list all payments or to search for a specific payment.</p>
<h3 id='get-payments'>Get payments</h3>
<p>Retrieve a list of all payments for this tenant.</p>

<p><strong>HTTP Request</strong> </p>

<p><code>GET http://127.0.0.1:8080/1.0/kb/payments/pagination</code></p>

<blockquote>
<p>Example Request:</p>
</blockquote>
<div class="highlight"><pre class="highlight shell tab-shell"><code>curl <span class="se">\</span>
    <span class="nt">-u</span> admin:password <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiKey: bob'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiSecret: lazar'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'Accept: application/json'</span> <span class="se">\</span>
    <span class="s1">'http://127.0.0.1:8080/1.0/kb/payments/pagination'</span> 
</code></pre></div><div class="highlight"><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">org.killbill.billing.client.api.gen.PaymentApi</span><span class="o">;</span>
<span class="kd">protected</span> <span class="nc">PaymentApi</span> <span class="n">paymentApi</span><span class="o">;</span>

<span class="nc">Long</span> <span class="n">offset</span> <span class="o">=</span> <span class="mi">0L</span><span class="o">;</span>
<span class="nc">Long</span> <span class="n">limit</span> <span class="o">=</span> <span class="mi">100L</span><span class="o">;</span>
<span class="nc">String</span> <span class="n">pluginName</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="nc">Boolean</span> <span class="n">withPluginInfo</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span> <span class="c1">// Will not fetch plugin info</span>
<span class="nc">Boolean</span> <span class="n">withAttempts</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span> <span class="c1">// Will reflect payment attempts</span>
<span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="no">NULL_PLUGIN_PROPERTIES</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

<span class="nc">Payments</span> <span class="n">payments</span> <span class="o">=</span> <span class="n">paymentApi</span><span class="o">.</span><span class="na">getPayments</span><span class="o">(</span><span class="n">offset</span><span class="o">,</span> 
                                           <span class="n">limit</span><span class="o">,</span> 
                                           <span class="n">pluginName</span><span class="o">,</span> 
                                           <span class="n">withPluginInfo</span><span class="o">,</span> 
                                           <span class="n">withAttempts</span><span class="o">,</span> 
                                           <span class="no">NULL_PLUGIN_PROPERTIES</span><span class="o">,</span> 
                                           <span class="nc">AuditLevel</span><span class="o">.</span><span class="na">NONE</span><span class="o">,</span> 
                                           <span class="n">requestOptions</span><span class="o">);</span>
</code></pre></div><div class="highlight"><pre class="highlight ruby tab-ruby"><code><span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">limit</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">payment</span><span class="p">.</span><span class="nf">find_in_batches</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> 
                        <span class="n">limit</span><span class="p">,</span> 
                        <span class="n">options</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="n">paymentApi</span> <span class="o">=</span> <span class="n">killbill</span><span class="p">.</span><span class="n">api</span><span class="p">.</span><span class="n">PaymentApi</span><span class="p">()</span>

<span class="n">paymentApi</span><span class="p">.</span><span class="n">get_payments</span><span class="p">(</span><span class="n">api_key</span><span class="p">,</span> <span class="n">api_secret</span><span class="p">)</span>
</code></pre></div>
<blockquote>
<p>Example Response:</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"accountId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ca15adc4-1061-4e54-a9a0-15e773b3b154"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"paymentId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4634b2ae-5263-4139-99b2-e2005f09a9fd"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"paymentNumber"</span><span class="p">:</span><span class="w"> </span><span class="s2">"7"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"paymentExternalKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4634b2ae-5263-4139-99b2-e2005f09a9fd"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"authAmount"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"capturedAmount"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"purchasedAmount"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"refundedAmount"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"creditedAmount"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"USD"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"paymentMethodId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dc89832d-18a3-42fd-b3be-cac074fddb36"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"transactions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"transactionId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"92935e84-fd79-4672-98bf-df84566153c6"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"transactionExternalKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"92935e84-fd79-4672-98bf-df84566153c6"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"paymentId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4634b2ae-5263-4139-99b2-e2005f09a9fd"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"paymentExternalKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4634b2ae-5263-4139-99b2-e2005f09a9fd"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"transactionType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PURCHASE"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="nl">"currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"USD"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"effectiveDate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-07-18T15:04:05.000Z"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"processedAmount"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
        </span><span class="nl">"processedCurrency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"USD"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PLUGIN_FAILURE"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"gatewayErrorCode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"RuntimeError"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"gatewayErrorMsg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Could not retrieve the payer info: the token is missing"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"firstPaymentReferenceId"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
        </span><span class="nl">"secondPaymentReferenceId"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
        </span><span class="nl">"properties"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
        </span><span class="nl">"auditLogs"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"paymentAttempts"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nl">"auditLogs"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div>
<p><strong>Query Parameters</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Required</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>offset</strong></td>
<td>long</td>
<td>no</td>
<td>0</td>
<td>Starting index for items listed</td>
</tr>
<tr>
<td><strong>limit</strong></td>
<td>long</td>
<td>no</td>
<td>100</td>
<td>Maximum number of items to be listed</td>
</tr>
<tr>
<td><strong>withPluginInfo</strong></td>
<td>boolean</td>
<td>no</td>
<td>false</td>
<td>if true, include plugin info</td>
</tr>
<tr>
<td><strong>withAttempts</strong></td>
<td>boolean</td>
<td>no</td>
<td>false</td>
<td>if true, include payment attempts</td>
</tr>
<tr>
<td><strong>audit</strong></td>
<td>string</td>
<td>no</td>
<td>&quot;NONE&quot;</td>
<td>Level of audit information to return: &quot;NONE&quot;, &quot;MINIMAL&quot; (only inserts), or &quot;FULL&quot;</td>
</tr>
</tbody></table>

<p><strong>Response</strong></p>

<p>If successful, returns a status code of 200 and a list of all payments for this tenant.</p>
<h3 id='search-payments'>Search payments</h3>
<p>Search for a payment by a specified search string. The search string is compared against the <code>paymentNumber</code>, <code>paymentId</code>, <code>accountId</code>, or <code>transactionType</code> attributes. An exact match is required. </p>

<p><strong>HTTP Request</strong> </p>

<p><code>GET http://127.0.0.1:8080/1.0/kb/payments/search/{searchKey}</code></p>

<blockquote>
<p>Example Request:</p>
</blockquote>
<div class="highlight"><pre class="highlight shell tab-shell"><code>curl <span class="se">\</span>
    <span class="nt">-u</span> admin:password <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiKey: bob'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'X-Killbill-ApiSecret: lazar'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'Accept: application/json'</span> <span class="se">\</span>
    <span class="s1">'http://127.0.0.1:8080/1.0/kb/payments/search/8fe697d4-2c25-482c-aa45-f6cd5a48186d'</span> 
</code></pre></div><div class="highlight"><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">org.killbill.billing.client.api.gen.PaymentApi</span><span class="o">;</span>
<span class="kd">protected</span> <span class="nc">PaymentApi</span> <span class="n">paymentApi</span><span class="o">;</span>

<span class="nc">String</span> <span class="n">searchKey</span> <span class="o">=</span> <span class="s">"ccbc67f5-91cb-4b9a-9648-fa6aedaf0890"</span><span class="o">;</span>
<span class="nc">Long</span> <span class="n">offset</span> <span class="o">=</span> <span class="mi">0L</span><span class="o">;</span>
<span class="nc">Long</span> <span class="n">limit</span> <span class="o">=</span> <span class="mi">100L</span><span class="o">;</span>
<span class="nc">Boolean</span> <span class="n">withPluginInfo</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span> <span class="c1">// Will not reflect plugin info</span>
<span class="nc">Boolean</span> <span class="n">withAttempts</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>  <span class="c1">// Will reflect payment attempts</span>
<span class="nc">String</span> <span class="n">pluginName</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="no">NULL_PLUGIN_PROPERTIES</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

<span class="nc">Payments</span> <span class="n">payments</span> <span class="o">=</span> <span class="n">paymentApi</span><span class="o">.</span><span class="na">searchPayments</span><span class="o">(</span><span class="n">searchKey</span><span class="o">,</span> 
                                              <span class="n">offset</span><span class="o">,</span> 
                                              <span class="n">limit</span><span class="o">,</span> 
                                              <span class="n">withPluginInfo</span><span class="o">,</span> 
                                              <span class="n">withAttempts</span><span class="o">,</span> 
                                              <span class="n">pluginName</span><span class="o">,</span> 
                                              <span class="no">NULL_PLUGIN_PROPERTIES</span><span class="o">,</span> 
                                              <span class="nc">AuditLevel</span><span class="o">.</span><span class="na">NONE</span><span class="o">,</span> 
                                              <span class="n">requestOptions</span><span class="o">);</span>
</code></pre></div><div class="highlight"><pre class="highlight ruby tab-ruby"><code><span class="n">search_key</span> <span class="o">=</span> <span class="s1">'PURCHASE'</span>
<span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">limit</span> <span class="o">=</span> <span class="mi">100</span>

<span class="n">payment</span><span class="p">.</span><span class="nf">find_in_batches_by_search_key</span><span class="p">(</span><span class="n">search_key</span><span class="p">,</span>
                                      <span class="n">offset</span><span class="p">,</span>
                                      <span class="n">limit</span><span class="p">,</span>
                                      <span class="n">options</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="n">paymentApi</span> <span class="o">=</span> <span class="n">killbill</span><span class="p">.</span><span class="n">api</span><span class="p">.</span><span class="n">PaymentApi</span><span class="p">()</span>
<span class="n">search_key</span> <span class="o">=</span> <span class="s">'SUCCESS'</span>

<span class="n">paymentApi</span><span class="p">.</span><span class="n">search_payments</span><span class="p">(</span><span class="n">search_key</span><span class="p">,</span> <span class="n">api_key</span><span class="p">,</span> <span class="n">api_secret</span><span class="p">)</span>
</code></pre></div>
<blockquote>
<p>Example Response:</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"accountId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"84c7e0d4-a5ed-405f-a655-3ed16ae19997"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"paymentId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"8fe697d4-2c25-482c-aa45-f6cd5a48186d"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"paymentNumber"</span><span class="p">:</span><span class="w"> </span><span class="s2">"14"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"paymentExternalKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"paymentExternalKey"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"authAmount"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nl">"capturedAmount"</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w">
    </span><span class="nl">"purchasedAmount"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"refundedAmount"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
    </span><span class="nl">"creditedAmount"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"USD"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"paymentMethodId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"916619a4-02bb-4d3d-b3da-2584ac897b19"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"transactions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"transactionId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"208d38df-8d5a-4e20-89df-15db4b3516b4"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"transactionExternalKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"208d38df-8d5a-4e20-89df-15db4b3516b4"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"paymentId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"8fe697d4-2c25-482c-aa45-f6cd5a48186d"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"paymentExternalKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"paymentExternalKey"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"transactionType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AUTHORIZE"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="nl">"currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"USD"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"effectiveDate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-07-19T16:39:00.000Z"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"processedAmount"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="nl">"processedCurrency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"USD"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SUCCESS"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"gatewayErrorCode"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
        </span><span class="nl">"gatewayErrorMsg"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
        </span><span class="nl">"firstPaymentReferenceId"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
        </span><span class="nl">"secondPaymentReferenceId"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
        </span><span class="nl">"properties"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
        </span><span class="nl">"auditLogs"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"paymentAttempts"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nl">"auditLogs"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div>
<p><strong>Query Parameters</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Required</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>searchKey</strong></td>
<td>string</td>
<td>yes</td>
<td>none</td>
<td>What you want to find</td>
</tr>
<tr>
<td><strong>offset</strong></td>
<td>long</td>
<td>no</td>
<td>0</td>
<td>Starting index for items listed</td>
</tr>
<tr>
<td><strong>limit</strong></td>
<td>long</td>
<td>no</td>
<td>100</td>
<td>Maximum number of items to be listed</td>
</tr>
<tr>
<td><strong>withPluginInfo</strong></td>
<td>boolean</td>
<td>no</td>
<td>false</td>
<td>if true, include plugin info</td>
</tr>
<tr>
<td><strong>withAttempts</strong></td>
<td>boolean</td>
<td>no</td>
<td>false</td>
<td>if true, include payment attempts</td>
</tr>
<tr>
<td><strong>audit</strong></td>
<td>string</td>
<td>no</td>
<td>&quot;NONE&quot;</td>
<td>Level of audit information to return: &quot;NONE&quot;, &quot;MINIMAL&quot; (only inserts), or &quot;FULL&quot;</td>
</tr>
</tbody></table>

<p><strong>Response</strong></p>

<p>If successful, returns a status code of 200 and a list of all payments matched with the search key entered.</p>

        </div>
        <div class="dark-box">
          <div id="docsearch"></div>
        </div>
      </div>
    </body>
    <script>
      setTimeout(function(){
        $('.content h2, .content h3, .content h4').append('<a href=""><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>');
        $('.content h2, .content h3, .content h4').each(function(){
          let itemHref = '#' + $(this).attr('id');
          $(this).find('a').attr("href", itemHref);
        });
      })
    </script>
    <script src='https://cdn.jsdelivr.net/npm/@docsearch/js@3'></script>
    <script>
      docsearch({apiKey: '3ef227e7fd5e2e1a3fffd880484934bf', container: '#docsearch', appId: 'S2ISXITURI', indexName: 'killbill_slate'});
    </script>
  </html>
